var S=function(x){if(x.ok)return x.json()},d=function(x){I.abort(x),I=new AbortController,P.signal=I.signal},H={NAV_LINK:"0",COLL_TITLE:"4",COLL_BUTTON:"5",COLL_ITEM:"6",MODAL:"8",MODAL_CLOSE:"9",MODAL_GENRE:"10",MODAL_COMPANY:"11",MODAL_CAST:"12",MODAL_C_MORE:"13",MODAL_SEASON_N:"14"},m={random(x){return Math.floor(Math.random()*x)},randomPermutation(x){var $=x.length;for(var z=0;z<$-1;z+=1){var K=z+Math.floor(Math.random()*($-z)),Q=x[z];x[z]=x[K],x[K]=Q}}},L={current:"dark",DARK:"dark",LIGHT:"light",init(){var x=localStorage.getItem("theme");if(x==="dark"||x==="light")L.current=x;else{if(window.matchMedia!==void 0&&window.matchMedia("(prefers-color-scheme: dark)").matches)L.current=L.DARK;else L.current=L.LIGHT;localStorage.setItem("theme",L.current)}document.firstElementChild?.setAttribute("class",L.current)},change(x){localStorage.setItem("theme",x),document.firstElementChild?.setAttribute("class",L.current)},onclick(x){var $=x.currentTarget;if($===null)return;if(L.current===L.DARK)L.current=L.LIGHT;else L.current=L.DARK;$.setAttribute("data-type",L.current),L.change(L.current)}},u={getGenres(x){return fetch(`${window.location.origin}/api/genres?t=${x}`).then(S)},getImages(x,$){return fetch(`${window.location.origin}/api/images?t=${$}&i=${x}`).then(S)},getTrending(x,$="1"){return fetch(`${window.location.origin}/api/trending?t=${x}&p=${$}`).then(S)},getPopular(x,$="1"){return fetch(`${window.location.origin}/api/popular?t=${x}&p=${$}`).then(S)},getDiscover(x,$,z="1"){var K=`${window.location.origin}/api/discover?t=${x}&p=${z}`;if($!==void 0)K=`${K}&g=${$}`;return fetch(K).then(S)},getTopRated(x,$="1"){return fetch(`${window.location.origin}/api/toprated?t=${x}&p=${$}`).then(S)},get(x,$,z,K){var Q=`${window.location.origin}/api/${x}?i=${$}`;if(z)Q+="&s";return fetch(Q,K).then(S)},getCredits(x,$,z){return fetch(`${window.location.origin}/api/credits?t=${x}&i=${$}`,z).then(S)},getSeason(x,$,z){return fetch(`${window.location.origin}/api/season?i=${x}&n=${$}`,z).then(S)}},C={ATTR_SHOW:"data-mbshow",HIDDEN:"0",SHOW:"1",buttonNavOnclick(x){var $=x.currentTarget,z=$.nextElementSibling;if(z.getAttribute(C.ATTR_SHOW)===C.HIDDEN)z.setAttribute(C.ATTR_SHOW,C.SHOW),z.firstElementChild.firstElementChild.focus();else z.setAttribute(C.ATTR_SHOW,C.HIDDEN)},navOnfocusout(x){var $=x.relatedTarget,z=$?.getAttribute("data-type");if($===null||z!==H.NAV_LINK){var K=x.currentTarget;K.setAttribute(C.ATTR_SHOW,C.HIDDEN)}}},i={select(x){return x[m.random(x.length)]},selectHero(x){if(x){if(!x.results||x.results.length===0)throw Error("trending.results does not have data");return i.select(x.results)}},async getHeroLogo(x){if(x===void 0)return;var{id:$,media_type:z}=x,K=await u.getImages($,z);if(K.logos.length>0)return K.logos[0].file_path;else return},initDOMImgLogo(x,$){var z=$.lastElementChild.firstElementChild;if(x!==void 0)z.firstElementChild.setAttribute("data-opacity","0"),z.lastElementChild.setAttribute("data-display","1"),z.lastElementChild.setAttribute("src",`https://image.tmdb.org/t/p/w300${x}`)},initDOM(x,$){var z=$.firstElementChild.firstElementChild,K=$.lastElementChild,Q=K.firstElementChild.firstElementChild,X=K.lastElementChild;if(z.setAttribute("data-display","1"),z.setAttribute("src",`https://image.tmdb.org/t/p/w1280${x.backdrop_path}`),x.media_type==="tv")Q.insertAdjacentText("beforeend",x.name);else Q.insertAdjacentText("beforeend",x.title);K.setAttribute("href",F.getHref(x.media_type,x.id)),K.setAttribute("data-media",x.media_type),K.setAttribute("data-id",x.id),X.insertAdjacentText("beforeend",x.overview)},DOMTitleOnclick(x,$,z){var K=x.getAttribute("data-id"),Q=x.getAttribute("data-media");if(K!==null&&Q!==null)z.preventDefault(),W.open(Q,K,$,!0)}},F={url:new URL(window.location.href),origin:`${window.location.origin}${window.location.pathname}`,getHref(x,$){return`${F.origin}?t=${x}&i=${$}`},pushstate(x){history.pushState(void 0,"",x)},init(x){var $=F.url.searchParams.get("t"),z=F.url.searchParams.get("i");if($!==null&&z!==null)if($=="tv"||$=="movie")W.open($,z,x,!1);else console.error(`Bad query: 'type=${$}'`)},onpopstate(x){F.url.href=window.location.href;var $=F.url.searchParams.get("t"),z=F.url.searchParams.get("i");if($!==null||z!==null){if(W.close(x),$==="tv"||$==="movie")W.open($,z,x,!1)}else if(W.isOpen)W.close(x)}},E={TYPE_SBUTTON:"data-sbuttont",TRENDING:"0",POPULAR:"1",TOP_RATED:"2",DISCOVER:"3",DOMCollButtonOnclick(x){var $=x.parentElement.lastElementChild;const z=x.parentElement.children[1],K=x.parentElement.children[2];var Q=x.getAttribute(E.TYPE_SBUTTON),X=$.clientWidth-$.clientWidth*6/100;if($.scrollLeft-X<=0)z.setAttribute("data-display","0");else z.setAttribute("data-display","1");if(Q==="0"){if($.scrollBy(-X,0),$.scrollLeft-X<=0)z.setAttribute("data-display","0");K.setAttribute("data-display","1")}else{if($.scrollBy(X,0),$.scrollLeft+X>=$.scrollWidth-$.clientWidth)K.setAttribute("data-display","0");z.setAttribute("data-display","1")}},createDOMCollection(x,$,z,K,Q){var X=Q.children[1].cloneNode(!0),U=Q.children[2],J=X.children[0];J.insertAdjacentText("beforeend",x),J.setAttribute("href",`${window.location.origin}/collection?t=${z}&c=${K}`);for(var q of $){const A=U.cloneNode(!0);A.setAttribute("data-id",q.id);let N,Z;if(z!=="all")Z=z;else Z=q.media_type;if(Z==="movie")N=q.title;else N=q.name;A.setAttribute("title",N),A.setAttribute("href",F.getHref(Z,q.id)),A.setAttribute("data-media",Z),A.lastElementChild.insertAdjacentText("beforeend",N),A.firstElementChild.setAttribute("alt",N),c.setItemImage(u.getImages(q.id,Z),A,q.backdrop_path),X.lastElementChild.appendChild(A)}return X}},c={topScroll:0,async setItemImage(x,$,z){var K=await x,Q=$.firstElementChild;if(K===void 0||K.backdrops===void 0||K.backdrops.length===0){if(z!==null&&z.length>0)Q.setAttribute("src",`https://image.tmdb.org/t/p/w400${z}`),Q.setAttribute("data-display","1"),$.lastElementChild?.setAttribute("data-opacity","0")}else{var X=K.backdrops[0];Q.setAttribute("src",`https://image.tmdb.org/t/p/w400${X.file_path}`),Q.setAttribute("data-display","1"),$.lastElementChild?.setAttribute("data-opacity","0")}},async discover(x,$,z,K,Q,X){var U=await x;if(console.info($,U),U?.results===void 0||U.results.length===0)throw Error("API.getTopRated does not have data");var J=E.createDOMCollection($,U.results,z,E.DISCOVER,X.templateCollection.content),q=X.view.children[Q+K];q.insertAdjacentElement("beforebegin",J),q.remove()},onclick(x,$,z){var K=x.getAttribute("data-type");if(K===H.COLL_BUTTON)E.DOMCollButtonOnclick(x);else if(K===H.COLL_ITEM){z.preventDefault();var Q=x.getAttribute("data-media"),X=x.getAttribute("data-id");if(Q!==null&&X!==null)W.open(Q,X,$,!0);else console.error("View onclick bad mediaType or id")}}},I=new AbortController,P={signal:I.signal},W={fragment:document.createDocumentFragment(),id:"",isOpen:!1,mediaType:"tv",creditsLoaded:!1,dataLoaded:!1,similarLoaded:!1,seasonLoaded:!1,seasonNumber:-1,async getCredit(x,$,z,K){var Q=await u.getCredits(x,$,P);if(console.info("credits:",Q),Q===void 0)return;W.DOMMCreditsFill(Q,x,z,K),W.creditsLoaded=!0},async getData(x,$,z,K){var Q;try{Q=await u.get(x,$,!1,P)}catch{W.close(z);return}if(console.info("data:",Q),Q===void 0){W.close(z);return}if(K)F.pushstate(F.getHref(x,$));if(x==="tv"){var X=z.modal.children[0];W.getCredit(x,$,X,z.templateModal.content),W.getSimilar(x,$,X,z.templateModal.content);var U=Q.seasons;if(U.length>0){var J=!1;for(var q of U)if(q.season_number===1){J=!0;break}if(J)W.seasonNumber=1;else W.seasonNumber=U[0].season_number;W.getSeason($,W.seasonNumber,X,z.templateModal.content)}else W.seasonNumber=-1;W.DOMMTvFill(Q,z)}else{var A=z.modal.children[1];W.getCredit(x,$,A,z.templateModal.content),W.getSimilar(x,$,A,z.templateModal.content),W.DOMMMovieFill(Q,z)}W.dataLoaded=!0},async getSeason(x,$,z,K){var Q=await u.getSeason(x,$,P);if(console.info("season:",Q),Q===void 0)return;W.DOMSeasonFill(Q,z,K),W.seasonLoaded=!0},async getSimilar(x,$,z,K){var Q=await u.get(x,$,!0,P);if(console.info("similars:",Q),Q===void 0)return;W.DOMMSimilarFill(Q,x,z,K),W.similarLoaded=!0},orderCredits(x){if(x.length<2)return x.length;var $=0,z=0,K=0,Q=1;for(var X=1;X<x.length;X+=1){var U=x[X];if(U.department!=="Crew"){while($<=z){if($<z)K=Math.floor(($+z)/2);else K=$;if(U.department<x[K].department)z=K-1;else if(U.department>x[K].department)$=K+1;else if(U.job<x[K].job)z=K-1;else $=K+1}if($!==Q)x.copyWithin($+1,$,Q);x[$]=U,$=0,z=Q,Q+=1}}return Q},DOMSeasonFill(x,$,z){var K=$.children[3].children[6],Q=z.children[8],X=z.children[4],U=K.firstElementChild.firstElementChild,J=K.children[1],q=K.children[2],A=K.children[3];if(A.setAttribute("data-more","0"),U.textContent=`${x.episodes.length} episodes`,J.textContent=x.name,q.textContent=x.overview,x.episodes.length>0){var N=x.episodes;for(var Z of N){var _=Q.cloneNode(!0),k=_.children[0].firstElementChild,w=_.children[1],V=_.children[2].children[0],b=_.children[2].children[1],v=_.children[2].children[2],G=_.children[2].children[3];if(Z.still_path!==null)k.setAttribute("src",`https://image.tmdb.org/t/p/w400${Z.still_path}`),k.setAttribute("alt",Z.name);if(V.textContent=Z.air_date,w.textContent=Z.episode_number,b.textContent=Z.name,Z.runtime!==null)v.textContent=`${Z.runtime} min`;G.textContent=Z.overview,W.fragment.appendChild(_)}if(x.episodes.length>4){var R=X.cloneNode(!0);R.textContent="more +",R.setAttribute("data-type",H.MODAL_C_MORE),W.fragment.appendChild(R)}A.replaceChildren(W.fragment)}else A.replaceChildren()},DOMMSimilarFill(x,$,z,K){var Q=z.children[3].children.length,X=z.children[3].children[Q-2],U=X.lastElementChild,J=K.children[5],q=x.results;if(q!=null&&0<q.length){X.setAttribute("data-display","1");var A=0;while(A<q.length){var N=q[A],Z=J.cloneNode(!0);Z.setAttribute("data-id",N.id);let w;if($==="movie")w=N.title;else w=N.name;Z.setAttribute("title",w),Z.setAttribute("data-media",$);var{firstElementChild:_,lastElementChild:k}=Z;if(_.setAttribute("alt",w),k.insertAdjacentText("beforeend",w),N.poster_path!=null&&N.poster_path.length>0)_.setAttribute("src",`https://image.tmdb.org/t/p/w200${N.poster_path}`);else _.setAttribute("data-display","0"),k.setAttribute("data-opacity","1");W.fragment.appendChild(Z),A+=1}U.appendChild(W.fragment)}},DOMMCreditsFill(x,$,z,K){var Q=z.children[3].children[5],X=z.children[3].lastElementChild,U=K.children[0],J=K.children[1],q=K.children[2],A=K.children[3],N=K.children[4],Z,_,k,w=x.cast;if(w.length>0){k=q.cloneNode(!0),k.setAttribute("data-more","0"),k.firstElementChild.textContent="Cast:";for(var V=0;V<w.length;V+=1){var b=w[V];if($==="movie")_=U.cloneNode(!1),_.setAttribute("href",`${window.location.origin}/collection?t=${$}&c=${E.DISCOVER}&ca=${b.id}`);else _=A.cloneNode(!1);_.setAttribute("data-id",b.id),_.setAttribute("data-type",H.MODAL_CAST),_.textContent=b.name,k.appendChild(_)}if(w.length>3){var v=N.cloneNode(!1);v.setAttribute("class","more"),v.setAttribute("data-type",H.MODAL_C_MORE),v.textContent="more",k.appendChild(v)}Q.appendChild(k),k=void 0}if(x.crew.length>0){var G=x.crew,R=W.orderCredits(G),B="",f="";for(var h=0;h<R;h+=1){var Y=G[h];if(Y.department!==B){if(Z!==void 0){if(k!==void 0)Z?.appendChild(k),k=void 0;W.fragment.appendChild(Z)}B=Y.department,Z=J.cloneNode(!0),Z.firstElementChild.textContent=B}if(Y.job!==f){if(k!==void 0)Z?.appendChild(k);f=Y.job,k=q.cloneNode(!0),k.firstElementChild.textContent=`${f}:`}if($==="movie"&&B==="Directing"&&(f==="Director"||f==="Series Director"||f==="Action Director"))_=U.cloneNode(!0),_.setAttribute("href",`${window.location.origin}/collection?t=${$}&c=${E.DISCOVER}&cr=${b.id}`),_.setAttribute("data-id",Y.id),_.setAttribute("data-type",H.MODAL_CAST);else _=A.cloneNode(!1);_.textContent=Y.name,k.appendChild(_)}if(Z!==void 0){if(k!==void 0)Z?.appendChild(k);W.fragment.appendChild(Z)}X?.appendChild(W.fragment)}},DOMMMovieFill(x,$){var z=$.modal,K=$.templateModal.content.children[2],_=$.templateModal.content.children[0],Q=z.children[1],X=Q.children[1].firstElementChild.firstElementChild,U=Q.children[3],J=U.children[0],q=U.children[1],A=U.children[2],N=U.children[3],Z=U.children[4],_=$.templateModal.content.children[0],k=$.templateModal.content.children[3],w=$.templateModal.content.children[4],V;if(J.textContent=x.title,N.textContent=x?.overview,x.runtime!==void 0)A.textContent=`${x.runtime} min`;if(x?.backdrop_path!=null)X.setAttribute("src",`https://image.tmdb.org/t/p/w780${x.backdrop_path}`),X.setAttribute("alt",x.title),X.setAttribute("data-display","1");if(x.genres.length>0){for(var b of x.genres)V=_.cloneNode(!0),V.textContent=b.name,V.setAttribute("href",`${window.location.origin}/collection?t=movie&c=${E.DISCOVER}&g=${b.id}`),V.setAttribute("data-id",b.id),V.setAttribute("data-type",H.MODAL_GENRE),W.fragment.appendChild(V);q.appendChild(W.fragment)}var v=K.cloneNode(!0);v.firstElementChild.textContent="Popularity:",V=k.cloneNode(!0),V.textContent=String(x.popularity),v.appendChild(V),Z?.appendChild(v);var G=K.cloneNode(!0);if(G.firstElementChild.textContent="Release Date:",V=k.cloneNode(!0),V.textContent=x.release_date,G.appendChild(V),Z?.appendChild(G),x.spoken_languages.length>0){var R=K.cloneNode(!0);R.firstElementChild.textContent="Languages:";for(var B of x.spoken_languages){if(V=k.cloneNode(!0),B.name.length>0)V.textContent=B.name;else V.textContent=B.english_name;R.appendChild(V)}Z?.appendChild(R)}if(x.production_countries.length>0){var f=K.cloneNode(!0);f.firstElementChild.textContent="Countries:";for(var h of x.production_countries)V=k.cloneNode(!0),V.textContent=h.name,f.appendChild(V);Z?.appendChild(f)}if(x.production_companies.length>0){var f=K.cloneNode(!0);f.setAttribute("data-more","0"),f.firstElementChild.textContent="Companies:";for(var Y of x.production_companies)V=_.cloneNode(!0),V.setAttribute("href",`${window.location.origin}/collection?t=movie&c=${E.DISCOVER}&co=${Y.id}`),V.setAttribute("data-type",H.MODAL_COMPANY),V.setAttribute("data-id",Y.id),V.textContent=Y.name,f.appendChild(V);if(x.production_companies.length>3){var j=w.cloneNode(!1);j.setAttribute("class","more"),j.setAttribute("data-type",H.MODAL_C_MORE),j.textContent="more",f.appendChild(j)}Z?.appendChild(f)}},DOMMTvFill(x,$){var z=$.modal,K=$.templateModal.content.children[2],k=$.templateModal.content.children[0],Q=z.children[0],X=Q.children[1].firstElementChild.firstElementChild,U=Q.children[3],J=U.children[0],q=U.children[1],A=U.children[2],N=U.children[3],Z=U.children[4],_=U.children[6],k=$.templateModal.content.children[0],w=$.templateModal.content.children[3],V=$.templateModal.content.children[4],b=$.templateModal.content.children[6],v=$.templateModal.content.children[7],G;if(J.textContent=x.name,N.textContent=x?.overview,A.textContent=`${x.number_of_episodes} episodes, ${x.number_of_seasons} seasons`,x?.backdrop_path!=null)X.setAttribute("src",`https://image.tmdb.org/t/p/w780${x.backdrop_path}`),X.setAttribute("alt",x.name),X.setAttribute("data-display","1");if(x.genres.length>0){for(var R of x.genres)G=k.cloneNode(!0),G.textContent=R.name,G.setAttribute("href",`${window.location.origin}/collection?t=tv&c=${E.DISCOVER}&g=${R.id}`),G.setAttribute("data-id",R.id),G.setAttribute("data-type",H.MODAL_GENRE),W.fragment.appendChild(G);q.appendChild(W.fragment)}var B=K.cloneNode(!0);B.firstElementChild.textContent="Popularity:",G=w.cloneNode(!0),G.textContent=String(x.popularity),B.appendChild(G),Z?.appendChild(B);var f=K.cloneNode(!0);if(f.firstElementChild.textContent="First Air Date:",G=w.cloneNode(!0),G.textContent=x.first_air_date,f.appendChild(G),Z.appendChild(f),x.spoken_languages.length>0){var h=K.cloneNode(!0);h.firstElementChild.textContent="Languages:";for(var Y of x.spoken_languages){if(G=w.cloneNode(!0),Y.name.length>0)G.textContent=Y.name;else G.textContent=Y.english_name;h.appendChild(G)}Z?.appendChild(h)}if(x.production_countries.length>0){var j=K.cloneNode(!0);j.firstElementChild.textContent="Countries:";for(var o of x.production_countries)G=w.cloneNode(!0),G.textContent=o.name,j.appendChild(G);Z?.appendChild(j)}if(x.production_companies.length>0){var j=K.cloneNode(!0);j.setAttribute("data-more","0"),j.firstElementChild.textContent="Companies:";for(var T of x.production_companies)G=k.cloneNode(!0),G.setAttribute("href",`${window.location.origin}/collection?t=tv&c=${E.DISCOVER}&co=${T.id}`),G.setAttribute("data-type",H.MODAL_COMPANY),G.setAttribute("data-id",T.id),G.textContent=T.name,j.appendChild(G);if(x.production_companies.length>3){var y=V.cloneNode(!1);y.setAttribute("class","more"),y.setAttribute("data-type",H.MODAL_C_MORE),y.textContent="more",j.appendChild(y)}Z?.appendChild(j)}if(W.seasonNumber!==-1){var s=x.seasons,r=b.content.cloneNode(!0),l=r.children[0].lastElementChild;if(_.setAttribute("data-display","1"),s.length>1)for(let n=0;n<s.length;n+=1){var p=s[n].season_number,g=v.cloneNode(!1);if(p===1)g.setAttribute("selected","true");g.textContent=`Season ${p}`,g.setAttribute("value",String(p)),l.appendChild(g)}else l.setAttribute("data-display","0");_.appendChild(r)}},close(x){if(!W.dataLoaded||!W.creditsLoaded||!W.similarLoaded||!W.seasonLoaded)d("The modal is closed");var $;if(W.mediaType==="tv")$=x.modal.children[0];else $=x.modal.children[1];var z=$.children[1].firstElementChild?.firstElementChild,K=$.children[3];z?.setAttribute("data-display","0"),z?.setAttribute("src",""),z?.setAttribute("alt","");var Q=K.children.length;if(K.children[0].replaceChildren(),K.children[1].replaceChildren(),K.children[2].replaceChildren(),K.children[3].replaceChildren(),K.children[4].replaceChildren(),K.children[5].replaceChildren(),K.lastElementChild.replaceChildren(),W.mediaType==="tv"){var X=K.children[6];X.replaceChildren(),X.setAttribute("data-display","0")}var U=K.children[Q-2];U.setAttribute("data-display","0"),U.lastElementChild.replaceChildren(),x.main.style.removeProperty("transform"),x.main.style.setProperty("position","relative"),x.modal.setAttribute("data-display","0"),document.firstElementChild.scrollTop=c.topScroll,W.isOpen=!1,W.seasonNumber=-1,W.id="",W.dataLoaded=!1,W.creditsLoaded=!1,W.similarLoaded=!1,W.seasonLoaded=!1},open(x,$,z,K){c.topScroll=document.firstElementChild.scrollTop,document.firstElementChild.scrollTop=0,W.isOpen=!0,W.mediaType=x,W.id=$,z.modal.setAttribute("data-display","1"),z.modal.setAttribute("data-select",x),z.main.style.setProperty("transform",`translateY(-${c.topScroll}px)`),z.main.style.setProperty("position","fixed"),W.getData(x,$,z,K)},onchange(x,$){var z=x.getAttribute("data-type");if(z===H.MODAL_SEASON_N){var K=Number(x.value);if(K===NaN)return;if(K!==W.seasonNumber)W.seasonNumber=K,W.getSeason(W.id,K,$.modal.children[0],$.templateModal.content)}},onclick(x,$){var z=x.getAttribute("data-type");if(z===H.MODAL||z===H.MODAL_CLOSE)W.close($),F.pushstate(F.origin);else if(z===H.MODAL_C_MORE)x.parentElement.setAttribute("data-more","1");else if(z===H.COLL_ITEM){var K=x?.getAttribute("data-id"),Q=x?.getAttribute("data-media");W.close($),W.open(Q,K,$,!0)}}},O={TYPE:H,API:u,Theme:L,Hero:i,Nav:C,Route:F,View:c,Modal:W,Collection:E,Utils:m};export{O as default};
