var E=function($){if($.ok)return $.json()},o=function($){g.abort($),g=new AbortController,P.signal=g.signal},J={NAV_LINK:"0",ITEM:"6",MODAL:"8",MODAL_CLOSE:"9",MODAL_GENRE:"10",MODAL_COMPANY:"11",MODAL_CAST:"12",MODAL_C_MORE:"13",MODAL_SEASON_N:"14"},p={random($){return Math.floor(Math.random()*$)},randomPermutation($){var z=$.length;for(var K=0;K<z-1;K+=1){var Q=K+Math.floor(Math.random()*(z-K)),V=$[K];$[K]=$[Q],$[Q]=V}}},L={current:"dark",DARK:"dark",LIGHT:"light",init(){var $=localStorage.getItem("theme");if($==="dark"||$==="light")L.current=$;else{if(window.matchMedia!==void 0&&window.matchMedia("(prefers-color-scheme: dark)").matches)L.current=L.DARK;else L.current=L.LIGHT;localStorage.setItem("theme",L.current)}document.firstElementChild?.setAttribute("class",L.current)},change($){localStorage.setItem("theme",$),document.firstElementChild?.setAttribute("class",L.current)},onclick($){var z=$.currentTarget;if(z===null)return;if(L.current===L.DARK)L.current=L.LIGHT;else L.current=L.DARK;z.setAttribute("data-type",L.current),L.change(L.current)}},h={getGenres($){return fetch(`${window.location.origin}/api/genres?t=${$}`).then(E)},getImages($,z){return fetch(`${window.location.origin}/api/images?t=${z}&i=${$}`).then(E)},getTrending($,z="1"){return fetch(`${window.location.origin}/api/trending?t=${$}&p=${z}`).then(E)},getPopular($,z="1"){return fetch(`${window.location.origin}/api/popular?t=${$}&p=${z}`).then(E)},getDiscover($,z="1",K,Q,V,_){var X=`${window.location.origin}/api/discover?t=${$}&p=${z}`;if(K!==void 0)X=`${X}&g=${K}`;else if(Q!==void 0)X=`${X}&ca=${Q}`;else if(V!==void 0)X=`${X}&cr=${V}`;else if(_!==void 0)X=`${X}&co=${_}`;return fetch(X).then(E)},getTopRated($,z="1"){return fetch(`${window.location.origin}/api/toprated?t=${$}&p=${z}`).then(E)},get($,z,K,Q){var V=`${window.location.origin}/api/${$}?i=${z}`;if(K)V+="&s";return fetch(V,Q).then(E)},getCredits($,z,K){return fetch(`${window.location.origin}/api/credits?t=${$}&i=${z}`,K).then(E)},getSeason($,z,K){return fetch(`${window.location.origin}/api/season?i=${$}&n=${z}`,K).then(E)}},R={ATTR_SHOW:"data-mbshow",HIDDEN:"0",SHOW:"1",buttonNavOnclick($){var z=$.currentTarget,K=z.nextElementSibling;if(K.getAttribute(R.ATTR_SHOW)===R.HIDDEN)K.setAttribute(R.ATTR_SHOW,R.SHOW),K.firstElementChild.firstElementChild.focus()},navOnfocusout($){var z=$.relatedTarget,K=z?.getAttribute("data-type");if(z===null||K!==J.NAV_LINK){var Q=$.currentTarget;Q.setAttribute(R.ATTR_SHOW,R.HIDDEN)}}},r={select($){return $[p.random($.length)]},selectHero($){if($){if(!$.results||$.results.length===0)throw Error("trending.results does not have data");return r.select($.results)}},async getHeroLogo($){if($===void 0)return;var{id:z,media_type:K}=$,Q=await h.getImages(z,K);if(Q.logos.length>0)return Q.logos[0].file_path;else return},initDOMImgLogo($,z){var K=z.lastElementChild.firstElementChild;if($!==void 0)K.firstElementChild.setAttribute("data-opacity","0"),K.lastElementChild.setAttribute("data-display","1"),K.lastElementChild.setAttribute("src",`https://image.tmdb.org/t/p/w300${$}`)},initDOM($,z){var K=z.firstElementChild.firstElementChild,Q=z.lastElementChild,V=Q.firstElementChild,_=V.firstElementChild,X=Q.lastElementChild;if(K.setAttribute("data-display","1"),K.setAttribute("src",`https://image.tmdb.org/t/p/w1280${$.backdrop_path}`),$.media_type==="tv")_.insertAdjacentText("beforeend",$.name);else _.insertAdjacentText("beforeend",$.title);if(V.setAttribute("href",U.getHref($.media_type,$.id)),V.setAttribute("data-media",$.media_type),V.setAttribute("data-id",$.id),$.overview!==void 0)if($.overview.length>300){var j=$.overview.lastIndexOf(" ",300),k=`${$.overview.substring(0,j)}...`;X.insertAdjacentText("beforeend",k)}else X.insertAdjacentText("beforeend",$.overview)},DOMTitleOnclick($,z,K){K.preventDefault();var Q=$.getAttribute("data-id"),V=$.getAttribute("data-media");if(Q!==null&&V!==null)W.open(V,Q,z,!0)}},U={Q_TITLE:"tl",Q_MEDIA_TYPE:"t",Q_GENRE:"g",Q_CREW:"cr",Q_CAST:"ca",Q_COMPANY:"co",Q_ID:"i",url:new URL(window.location.href),origin:`${window.location.origin}${window.location.pathname}`,href:`${window.location.origin}${window.location.pathname}`,hrefq:`${window.location.origin}${window.location.pathname}?`,getHref($,z){return`${U.hrefq}${U.Q_MEDIA_TYPE}=${$}&${U.Q_ID}=${z}`},pushstate($){history.pushState(void 0,"",$)},init($){var z=U.url.searchParams.get(U.Q_MEDIA_TYPE),K=U.url.searchParams.get(U.Q_ID);if(z!==null&&K!==null)if(z=="tv"||z=="movie")W.open(z,K,$,!1);else console.error(`Bad query: 'type=${z}'`)},onpopstate($){U.url.href=window.location.href;var z=U.url.searchParams.get(U.Q_MEDIA_TYPE),K=U.url.searchParams.get(U.Q_ID);if(W.isOpen)W.close($);if(K!==null&&(z==="tv"||z==="movie"))W.open(z,K,$,!1)}},i={createDOMItem($,z,K){if(z==="all")z=$.media_type;var Q=K.cloneNode(!0),V;if(z==="movie")V=$.title;else V=$.name;return Q.setAttribute("data-id",$.id),Q.setAttribute("title",V),Q.setAttribute("href",U.getHref(z,$.id)),Q.setAttribute("data-media",z),Q.lastElementChild.insertAdjacentText("beforeend",V),Q.firstElementChild.setAttribute("alt",V),i.setImage(h.getImages($.id,z),Q,$.backdrop_path),Q},async setImage($,z,K){var Q=await $,V=z.firstElementChild;if(Q===void 0||Q.backdrops===void 0||Q.backdrops.length===0){if(K!==null&&K.length>0)V.setAttribute("src",`https://image.tmdb.org/t/p/w400${K}`),V.setAttribute("data-display","1"),z.lastElementChild?.setAttribute("data-opacity","0")}else{var _=Q.backdrops[0];V.setAttribute("src",`https://image.tmdb.org/t/p/w400${_.file_path}`),V.setAttribute("data-display","1"),z.lastElementChild?.setAttribute("data-opacity","0")}}},g=new AbortController,P={signal:g.signal},W={fragment:document.createDocumentFragment(),topScroll:0,id:"",isOpen:!1,mediaType:"tv",creditsLoaded:!1,dataLoaded:!1,similarLoaded:!1,seasonLoaded:!1,seasonNumber:-1,async getCredit($,z,K,Q){var V=await h.getCredits($,z,P);if(console.info("credits:",V),V===void 0)return;W.DOMMCreditsFill(V,$,K,Q),W.creditsLoaded=!0},async getData($,z,K,Q){var V;try{V=await h.get($,z,!1,P)}catch{W.close(K);return}if(console.info("data:",V),V===void 0){W.close(K);return}if(Q)U.pushstate(U.getHref($,z));if($==="tv"){var _=K.modal.children[0];W.getCredit($,z,_,K.templateModal.content),W.getSimilar($,z,_,K.templateModal.content);var X=V.seasons;if(X.length>0){var j=!1;for(var k of X)if(k.season_number===1){j=!0;break}if(j)W.seasonNumber=1;else W.seasonNumber=X[0].season_number;W.getSeason(z,W.seasonNumber,_,K.templateModal.content)}else W.seasonNumber=-1;W.DOMMTvFill(V,K)}else{var H=K.modal.children[1];W.getCredit($,z,H,K.templateModal.content),W.getSimilar($,z,H,K.templateModal.content),W.DOMMMovieFill(V,K)}W.dataLoaded=!0},async getSeason($,z,K,Q){var V=await h.getSeason($,z,P);if(console.info("season:",V),V===void 0)return;W.DOMSeasonFill(V,K,Q),W.seasonLoaded=!0},async getSimilar($,z,K,Q){var V=await h.get($,z,!0,P);if(console.info("similars:",V),V===void 0)return;W.DOMMSimilarFill(V,$,K,Q),W.similarLoaded=!0},orderCredits($){if($.length<2)return $.length;var z=0,K=0,Q=0,V=1;for(var _=1;_<$.length;_+=1){var X=$[_];if(X.department!=="Crew"){while(z<=K){if(z<K)Q=Math.floor((z+K)/2);else Q=z;if(X.department<$[Q].department)K=Q-1;else if(X.department>$[Q].department)z=Q+1;else if(X.job<$[Q].job)K=Q-1;else z=Q+1}if(z!==V)$.copyWithin(z+1,z,V);$[z]=X,z=0,K=V,V+=1}}return V},DOMSeasonFill($,z,K){var Q=z.children[3].children[6],V=K.children[8],_=K.children[4],X=Q.firstElementChild.firstElementChild,j=Q.children[1],k=Q.children[2],H=Q.children[3];if(H.setAttribute("data-more","0"),X.textContent=`${$.episodes.length} episodes`,j.textContent=$.name,k.textContent=$.overview,$.episodes.length>0){var w=$.episodes;for(var Z of w){var x=V.cloneNode(!0),N=x.children[0].firstElementChild,A=x.children[1],f=x.children[2].children[0],b=x.children[2].children[1],B=x.children[2].children[2],G=x.children[2].children[3];if(Z.still_path!==null)N.setAttribute("src",`https://image.tmdb.org/t/p/w400${Z.still_path}`),N.setAttribute("alt",Z.name);if(f.textContent=Z.air_date,A.textContent=Z.episode_number,b.textContent=Z.name,Z.runtime!==null)B.textContent=`${Z.runtime} min`;G.textContent=Z.overview,W.fragment.appendChild(x)}if($.episodes.length>4){var F=_.cloneNode(!0);F.textContent="more +",F.setAttribute("data-type",J.MODAL_C_MORE),W.fragment.appendChild(F)}H.replaceChildren(W.fragment)}else H.replaceChildren()},DOMMSimilarFill($,z,K,Q){var V=K.children[3].children.length,_=K.children[3].children[V-2],X=_.lastElementChild,j=Q.children[5],k=$.results;if(k!=null&&0<k.length){_.setAttribute("data-display","1");var H=0;while(H<k.length){var w=k[H],Z=j.cloneNode(!0);Z.setAttribute("data-id",w.id);let A;if(z==="movie")A=w.title;else A=w.name;Z.setAttribute("title",A),Z.setAttribute("data-media",z);var{firstElementChild:x,lastElementChild:N}=Z;if(x.setAttribute("alt",A),N.insertAdjacentText("beforeend",A),w.poster_path!=null&&w.poster_path.length>0)x.setAttribute("src",`https://image.tmdb.org/t/p/w200${w.poster_path}`);else x.setAttribute("data-display","0"),N.setAttribute("data-opacity","1");W.fragment.appendChild(Z),H+=1}X.appendChild(W.fragment)}},DOMMCreditsFill($,z,K,Q){var V=K.children[3].children[5],_=K.children[3].lastElementChild,X=Q.children[0],j=Q.children[1],k=Q.children[2],H=Q.children[3],w=Q.children[4],Z,x,N,A=$.cast;if(A.length>0){N=k.cloneNode(!0),N.setAttribute("data-more","0"),N.firstElementChild.textContent="Cast:";for(var f=0;f<A.length;f+=1){var b=A[f];if(z==="movie")x=X.cloneNode(!1),x.setAttribute("href",`${window.location.origin}/discover?${U.Q_MEDIA_TYPE}=${z}&${U.Q_CAST}=${b.id}&${U.Q_TITLE}=${b.name} Movies`);else x=H.cloneNode(!1);x.setAttribute("data-id",b.id),x.setAttribute("data-type",J.MODAL_CAST),x.textContent=b.name,N.appendChild(x)}if(A.length>3){var B=w.cloneNode(!1);B.setAttribute("class","more"),B.setAttribute("data-type",J.MODAL_C_MORE),B.textContent="more",N.appendChild(B)}V.appendChild(N),N=void 0}if($.crew.length>0){var G=$.crew,F=W.orderCredits(G),C="",q="";for(var S=0;S<F;S+=1){var Y=G[S];if(Y.department!==C){if(Z!==void 0){if(N!==void 0)Z?.appendChild(N),N=void 0;W.fragment.appendChild(Z)}C=Y.department,Z=j.cloneNode(!0),Z.firstElementChild.textContent=C}if(Y.job!==q){if(N!==void 0)Z?.appendChild(N);q=Y.job,N=k.cloneNode(!0),N.firstElementChild.textContent=`${q}:`}if(z==="movie"&&C==="Directing"&&(q==="Director"||q==="Series Director"||q==="Action Director"))x=X.cloneNode(!0),x.setAttribute("href",`${window.location.origin}/discover?${U.Q_MEDIA_TYPE}=${z}&${U.Q_CREW}=${Y.id}&${U.Q_TITLE}=${Y.name} Movies`),x.setAttribute("data-id",Y.id),x.setAttribute("data-type",J.MODAL_CAST);else x=H.cloneNode(!1);x.textContent=Y.name,N.appendChild(x)}if(Z!==void 0){if(N!==void 0)Z?.appendChild(N);W.fragment.appendChild(Z)}_?.appendChild(W.fragment)}},DOMMMovieFill($,z){var K=z.modal,Q=z.templateModal.content.children[2],x=z.templateModal.content.children[0],V=K.children[1],_=V.children[1].firstElementChild.firstElementChild,X=V.children[3],j=X.children[0],k=X.children[1],H=X.children[2],w=X.children[3],Z=X.children[4],x=z.templateModal.content.children[0],N=z.templateModal.content.children[3],A=z.templateModal.content.children[4],f;if(j.textContent=$.title,w.textContent=$?.overview,$.runtime!==void 0)H.textContent=`${$.runtime} min`;if($?.backdrop_path!=null)_.setAttribute("src",`https://image.tmdb.org/t/p/w780${$.backdrop_path}`),_.setAttribute("alt",$.title),_.setAttribute("data-display","1");if($.genres.length>0){for(var b of $.genres)f=x.cloneNode(!0),f.textContent=b.name,f.setAttribute("href",`${window.location.origin}/discover?${U.Q_MEDIA_TYPE}=movie&${U.Q_GENRE}=${b.id}&${U.Q_TITLE}=${encodeURIComponent(b.name)} Movies`),f.setAttribute("data-id",b.id),f.setAttribute("data-type",J.MODAL_GENRE),W.fragment.appendChild(f);k.appendChild(W.fragment)}var B=Q.cloneNode(!0);B.firstElementChild.textContent="Popularity:",f=N.cloneNode(!0),f.textContent=String($.popularity),B.appendChild(f),Z?.appendChild(B);var G=Q.cloneNode(!0);if(G.firstElementChild.textContent="Release Date:",f=N.cloneNode(!0),f.textContent=$.release_date,G.appendChild(f),Z?.appendChild(G),$.spoken_languages.length>0){var F=Q.cloneNode(!0);F.firstElementChild.textContent="Languages:";for(var C of $.spoken_languages){if(f=N.cloneNode(!0),C.name.length>0)f.textContent=C.name;else f.textContent=C.english_name;F.appendChild(f)}Z?.appendChild(F)}if($.production_countries.length>0){var q=Q.cloneNode(!0);q.firstElementChild.textContent="Countries:";for(var S of $.production_countries)f=N.cloneNode(!0),f.textContent=S.name,q.appendChild(f);Z?.appendChild(q)}if($.production_companies.length>0){var q=Q.cloneNode(!0);q.setAttribute("data-more","0"),q.firstElementChild.textContent="Companies:";for(var Y of $.production_companies)f=x.cloneNode(!0),f.setAttribute("href",`${window.location.origin}/discover?${U.Q_MEDIA_TYPE}=movie&${U.Q_COMPANY}=${Y.id}&${U.Q_TITLE}=${encodeURIComponent(Y.name)} Movies`),f.setAttribute("data-type",J.MODAL_COMPANY),f.setAttribute("data-id",Y.id),f.textContent=Y.name,q.appendChild(f);if($.production_companies.length>3){var v=A.cloneNode(!1);v.setAttribute("class","more"),v.setAttribute("data-type",J.MODAL_C_MORE),v.textContent="more",q.appendChild(v)}Z?.appendChild(q)}},DOMMTvFill($,z){var K=z.modal,Q=z.templateModal.content.children[2],N=z.templateModal.content.children[0],V=K.children[0],_=V.children[1].firstElementChild.firstElementChild,X=V.children[3],j=X.children[0],k=X.children[1],H=X.children[2],w=X.children[3],Z=X.children[4],x=X.children[6],N=z.templateModal.content.children[0],A=z.templateModal.content.children[3],f=z.templateModal.content.children[4],b=z.templateModal.content.children[6],B=z.templateModal.content.children[7],G;if(j.textContent=$.name,w.textContent=$?.overview,H.textContent=`${$.number_of_episodes} episodes, ${$.number_of_seasons} seasons`,$?.backdrop_path!=null)_.setAttribute("src",`https://image.tmdb.org/t/p/w780${$.backdrop_path}`),_.setAttribute("alt",$.name),_.setAttribute("data-display","1");if($.genres.length>0){for(var F of $.genres)G=N.cloneNode(!0),G.textContent=F.name,G.setAttribute("href",`${window.location.origin}/discover?${U.Q_MEDIA_TYPE}=tv&${U.Q_GENRE}=${F.id}&${U.Q_TITLE}=${encodeURIComponent(F.name)} Tv Series`),G.setAttribute("data-id",F.id),G.setAttribute("data-type",J.MODAL_GENRE),W.fragment.appendChild(G);k.appendChild(W.fragment)}var C=Q.cloneNode(!0);C.firstElementChild.textContent="Popularity:",G=A.cloneNode(!0),G.textContent=String($.popularity),C.appendChild(G),Z?.appendChild(C);var q=Q.cloneNode(!0);if(q.firstElementChild.textContent="First Air Date:",G=A.cloneNode(!0),G.textContent=$.first_air_date,q.appendChild(G),Z.appendChild(q),$.spoken_languages.length>0){var S=Q.cloneNode(!0);S.firstElementChild.textContent="Languages:";for(var Y of $.spoken_languages){if(G=A.cloneNode(!0),Y.name.length>0)G.textContent=Y.name;else G.textContent=Y.english_name;S.appendChild(G)}Z?.appendChild(S)}if($.production_countries.length>0){var v=Q.cloneNode(!0);v.firstElementChild.textContent="Countries:";for(var m of $.production_countries)G=A.cloneNode(!0),G.textContent=m.name,v.appendChild(G);Z?.appendChild(v)}if($.production_companies.length>0){var v=Q.cloneNode(!0);v.setAttribute("data-more","0"),v.firstElementChild.textContent="Companies:";for(var c of $.production_companies)G=N.cloneNode(!0),G.setAttribute("href",`${window.location.origin}/discover?${U.Q_MEDIA_TYPE}=tv&${U.Q_COMPANY}=${c.id}&${U.Q_TITLE}=${encodeURIComponent(c.name)} Tv Series`),G.setAttribute("data-type",J.MODAL_COMPANY),G.setAttribute("data-id",c.id),G.textContent=c.name,v.appendChild(G);if($.production_companies.length>3){var u=f.cloneNode(!1);u.setAttribute("class","more"),u.setAttribute("data-type",J.MODAL_C_MORE),u.textContent="more",v.appendChild(u)}Z?.appendChild(v)}if(W.seasonNumber!==-1){var T=$.seasons,s=b.content.cloneNode(!0),n=s.children[0].lastElementChild;if(x.setAttribute("data-display","1"),T.length>1)for(let l=0;l<T.length;l+=1){var I=T[l].season_number,y=B.cloneNode(!1);if(I===1)y.setAttribute("selected","true");y.textContent=`Season ${I}`,y.setAttribute("value",String(I)),n.appendChild(y)}else n.setAttribute("data-display","0");x.appendChild(s)}},close($){if(!W.dataLoaded||!W.creditsLoaded||!W.similarLoaded||!W.seasonLoaded)o("The modal is closed");var z;if(W.mediaType==="tv")z=$.modal.children[0];else z=$.modal.children[1];var K=z.children[1].firstElementChild?.firstElementChild,Q=z.children[3];K?.setAttribute("data-display","0"),K?.setAttribute("src",""),K?.setAttribute("alt","");var V=Q.children.length;if(Q.children[0].replaceChildren(),Q.children[1].replaceChildren(),Q.children[2].replaceChildren(),Q.children[3].replaceChildren(),Q.children[4].replaceChildren(),Q.children[5].replaceChildren(),Q.lastElementChild.replaceChildren(),W.mediaType==="tv"){var _=Q.children[6];_.replaceChildren(),_.setAttribute("data-display","0")}var X=Q.children[V-2];X.setAttribute("data-display","0"),X.lastElementChild.replaceChildren(),$.main.style.removeProperty("transform"),$.main.toggleAttribute("data-fixed"),$.modal.setAttribute("data-display","0"),document.firstElementChild.scrollTop=W.topScroll,W.isOpen=!1,W.seasonNumber=-1,W.id="",W.dataLoaded=!1,W.creditsLoaded=!1,W.similarLoaded=!1,W.seasonLoaded=!1},open($,z,K,Q){W.topScroll=document.firstElementChild.scrollTop,document.firstElementChild.scrollTop=0,W.isOpen=!0,W.mediaType=$,W.id=z,K.modal.setAttribute("data-display","1"),K.modal.setAttribute("data-select",$),K.main.style.setProperty("transform",`translateY(-${W.topScroll}px)`),K.main.toggleAttribute("data-fixed"),W.getData($,z,K,Q)},onchange($,z){var K=$.getAttribute("data-type");if(K===J.MODAL_SEASON_N){var Q=Number($.value);if(Q===NaN)return;if(Q!==W.seasonNumber)W.seasonNumber=Q,W.getSeason(W.id,Q,z.modal.children[0],z.templateModal.content)}},onclick($,z){var K=$.getAttribute("data-type");if(K===J.MODAL||K===J.MODAL_CLOSE)W.close(z),U.pushstate(U.href);else if(K===J.MODAL_C_MORE)$.parentElement.setAttribute("data-more","1");else if(K===J.ITEM){var Q=$?.getAttribute("data-id"),V=$?.getAttribute("data-media");W.close(z),W.open(V,Q,z,!0)}}},d={TYPE:J,API:h,Theme:L,Hero:r,Nav:R,Route:U,Item:i,Modal:W,Utils:p};export{d as default};
