function R(z){if(z.ok)return z.json()}function o(z){g.abort(z),g=new AbortController,h.signal=g.signal}var j={NAV_LINK:"0",ITEM:"6",MODAL:"8",MODAL_CLOSE:"9",MODAL_GENRE:"10",MODAL_COMPANY:"11",MODAL_CAST:"12",MODAL_C_MORE:"13",MODAL_SEASON_N:"14"},n={random(z){return Math.floor(Math.random()*z)},randomPermutation(z){var K=z.length;for(var Q=0;Q<K-1;Q+=1){var V=Q+Math.floor(Math.random()*(K-Q)),X=z[Q];z[Q]=z[V],z[V]=X}}},Y={current:"dark",DARK:"dark",LIGHT:"light",init(){var z=localStorage.getItem("theme");if(z==="dark"||z==="light")Y.current=z;else{if(window.matchMedia!==void 0&&window.matchMedia("(prefers-color-scheme: dark)").matches)Y.current=Y.DARK;else Y.current=Y.LIGHT;localStorage.setItem("theme",Y.current)}document.firstElementChild?.setAttribute("class",Y.current)},change(z){localStorage.setItem("theme",z),document.firstElementChild?.setAttribute("class",Y.current)},onclick(z){var K=z.currentTarget;if(K===null)return;if(Y.current===Y.DARK)Y.current=Y.LIGHT;else Y.current=Y.DARK;K.setAttribute("data-type",Y.current),Y.change(Y.current)}},P={getGenres(z){return fetch(`${window.location.origin}/api/genres?t=${z}`).then(R)},getImages(z,K){return fetch(`${window.location.origin}/api/images?t=${K}&i=${z}`).then(R)},getTrending(z,K="1"){return fetch(`${window.location.origin}/api/trending?t=${z}&p=${K}`).then(R)},getPopular(z,K="1"){return fetch(`${window.location.origin}/api/popular?t=${z}&p=${K}`).then(R)},getDiscover(z,K="1",Q,V,X,x){var Z=`${window.location.origin}/api/discover?t=${z}&p=${K}`;if(Q!==void 0)Z=`${Z}&g=${Q}`;else if(V!==void 0)Z=`${Z}&ca=${V}`;else if(X!==void 0)Z=`${Z}&cr=${X}`;else if(x!==void 0)Z=`${Z}&co=${x}`;return fetch(Z).then(R)},getTopRated(z,K="1"){return fetch(`${window.location.origin}/api/toprated?t=${z}&p=${K}`).then(R)},get(z,K,Q,V){var X=`${window.location.origin}/api/${z}?i=${K}`;if(Q)X+="&s";return fetch(X,V).then(R)},getCredits(z,K,Q){return fetch(`${window.location.origin}/api/credits?t=${z}&i=${K}`,Q).then(R)},getSeason(z,K,Q){return fetch(`${window.location.origin}/api/season?i=${z}&n=${K}`,Q).then(R)},getSearch(z,K="1"){return fetch(`${window.location.origin}/api/search?q=${z}&p=${K}`).then(R)}},C={ATTR_SHOW:"data-mbshow",HIDDEN:"0",SHOW:"1",buttonNavOnclick(z){var K=z.currentTarget,Q=K.nextElementSibling;if(Q.getAttribute(C.ATTR_SHOW)===C.HIDDEN)Q.setAttribute(C.ATTR_SHOW,C.SHOW),Q.firstElementChild.firstElementChild.focus()},navOnfocusout(z){var K=z.relatedTarget,Q=K?.getAttribute("data-type");if(K===null||Q!==j.NAV_LINK){var V=z.currentTarget;V.setAttribute(C.ATTR_SHOW,C.HIDDEN)}}},r={select(z){return z[n.random(z.length)]},selectHero(z){if(z){if(!z.results||z.results.length===0)throw Error("trending.results does not have data");return r.select(z.results)}},async getHeroLogo(z){if(z===void 0)return;var{id:K,media_type:Q}=z,V=await P.getImages(K,Q);if(V.logos.length>0)return V.logos[0].file_path;else return},initDOMImgLogo(z,K){var Q=K.lastElementChild.firstElementChild;if(z!==void 0)Q.firstElementChild.setAttribute("data-opacity","0"),Q.lastElementChild.setAttribute("data-display","1"),Q.lastElementChild.setAttribute("src",`https://image.tmdb.org/t/p/w300${z}`)},initDOM(z,K){var Q=K.firstElementChild.firstElementChild,V=K.lastElementChild,X=V.firstElementChild,x=X.firstElementChild,Z=V.lastElementChild;if(Q.setAttribute("data-display","1"),Q.setAttribute("src",`https://image.tmdb.org/t/p/w1280${z.backdrop_path}`),z.media_type==="tv")x.insertAdjacentText("beforeend",z.name);else x.insertAdjacentText("beforeend",z.title);if(X.setAttribute("href",G.getHref(z.media_type,z.id)),X.setAttribute("data-media",z.media_type),X.setAttribute("data-id",z.id),z.overview!==void 0)if(z.overview.length>300){var f=z.overview.lastIndexOf(" ",300),J=`${z.overview.substring(0,f)}...`;Z.insertAdjacentText("beforeend",J)}else Z.insertAdjacentText("beforeend",z.overview)},DOMTitleOnclick(z,K,Q){Q.preventDefault();var V=z.getAttribute("data-id"),X=z.getAttribute("data-media");if(V!==null&&X!==null)W.open(X,V,K,!0)}},G={Q_TITLE:"tl",Q_MEDIA_TYPE:"t",Q_GENRE:"g",Q_CREW:"cr",Q_CAST:"ca",Q_COMPANY:"co",Q_ID:"i",Q_SEARCH:"q",url:new URL(window.location.href),origin:`${window.location.origin}${window.location.pathname}`,href:`${window.location.origin}${window.location.pathname}`,hrefq:`${window.location.origin}${window.location.pathname}?`,getHref(z,K){return`${G.hrefq}${G.Q_MEDIA_TYPE}=${z}&${G.Q_ID}=${K}`},pushstate(z){history.pushState(void 0,"",z)},init(z){var K=G.url.searchParams.get(G.Q_MEDIA_TYPE),Q=G.url.searchParams.get(G.Q_ID);if(K!==null&&Q!==null)if(K=="tv"||K=="movie")W.open(K,Q,z,!1);else console.error(`Bad query: 'type=${K}'`)},onpopstate(z){G.url.href=window.location.href;var K=G.url.searchParams.get(G.Q_MEDIA_TYPE),Q=G.url.searchParams.get(G.Q_ID);if(W.isOpen)W.close(z);if(Q!==null&&(K==="tv"||K==="movie"))W.open(K,Q,z,!1)}},i={createDOMItem(z,K,Q){if(K==="all")K=z.media_type;var V=Q.cloneNode(!0),X;if(K==="movie")X=z.title;else X=z.name;return V.setAttribute("data-id",z.id),V.setAttribute("title",X),V.setAttribute("href",G.getHref(K,z.id)),V.setAttribute("data-media",K),V.children.title.insertAdjacentText("beforeend",X),i.setImage(P.getImages(z.id,K),V,z.backdrop_path),V},async setImage(z,K,Q){var V=await z,X=K.lastElementChild;if(V===void 0||V.backdrops===void 0||V.backdrops.length===0){if(Q!==null&&Q.length>0)X.setAttribute("src",`https://image.tmdb.org/t/p/w400${Q}`),X.setAttribute("data-display","1")}else{var x=V.backdrops[0];X.setAttribute("src",`https://image.tmdb.org/t/p/w400${x.file_path}`),X.setAttribute("data-display","1")}}},g=new AbortController,h={signal:g.signal},W={fragment:document.createDocumentFragment(),topScroll:0,id:"",isOpen:!1,mediaType:"tv",creditsLoaded:!1,dataLoaded:!1,similarLoaded:!1,seasonLoaded:!1,seasonNumber:-1,async getCredit(z,K,Q,V){var X=await P.getCredits(z,K,h);if(X===void 0)return;W.DOMMCreditsFill(X,z,Q,V),W.creditsLoaded=!0},async getData(z,K,Q,V){var X;try{X=await P.get(z,K,!1,h)}catch{W.close(Q);return}if(X===void 0){W.close(Q);return}if(V)G.pushstate(G.getHref(z,K));if(z==="tv"){var x=Q.modal.children[0];W.getCredit(z,K,x,Q.templateModal.content),W.getSimilar(z,K,x,Q.templateModal.content);var Z=X.seasons;if(Z.length>0){var f=!1;for(var J of Z)if(J.season_number===1){f=!0;break}if(f)W.seasonNumber=1;else W.seasonNumber=Z[0].season_number;W.getSeason(K,W.seasonNumber,x,Q.templateModal.content)}else W.seasonNumber=-1;W.DOMMTvFill(X,Q)}else{var L=Q.modal.children[1];W.getCredit(z,K,L,Q.templateModal.content),W.getSimilar(z,K,L,Q.templateModal.content),W.DOMMMovieFill(X,Q)}W.dataLoaded=!0},async getSeason(z,K,Q,V){var X=await P.getSeason(z,K,h);if(X===void 0)return;W.DOMSeasonFill(X,Q,V),W.seasonLoaded=!0},async getSimilar(z,K,Q,V){var X=await P.get(z,K,!0,h);if(X===void 0)return;W.DOMMSimilarFill(X,z,Q,V),W.similarLoaded=!0},orderCredits(z){if(z.length<2)return z.length;var K=0,Q=0,V=0,X=1;for(var x=1;x<z.length;x+=1){var Z=z[x];if(Z.department!=="Crew"){while(K<=Q){if(K<Q)V=Math.floor((K+Q)/2);else V=K;if(Z.department<z[V].department)Q=V-1;else if(Z.department>z[V].department)K=V+1;else if(Z.job<z[V].job)Q=V-1;else K=V+1}if(K!==X)z.copyWithin(K+1,K,X);z[K]=Z,K=0,Q=X,X+=1}}return X},DOMSeasonFill(z,K,Q){var V=K.children[3].children[6],X=Q.children[8],x=Q.children[4],Z=V.firstElementChild.firstElementChild,f=V.children[1],J=V.children[2],L=V.children[3];if(L.setAttribute("data-more","0"),Z.textContent=`${z.episodes.length} episodes`,f.textContent=z.name,J.textContent=z.overview,z.episodes.length>0){var w=z.episodes;for(var $ of w){var _=X.cloneNode(!0),q=_.children[0].firstElementChild,N=_.children[1],k=_.children[2].children[0],b=_.children[2].children[1],v=_.children[2].children[2],U=_.children[2].children[3];if($.still_path!==null)q.setAttribute("src",`https://image.tmdb.org/t/p/w400${$.still_path}`),q.setAttribute("alt",$.name);if(k.textContent=$.air_date,N.textContent=$.episode_number,b.textContent=$.name,$.runtime!==null)v.textContent=`${$.runtime} min`;U.textContent=$.overview,W.fragment.appendChild(_)}if(z.episodes.length>4){var F=x.cloneNode(!0);F.textContent="more +",F.setAttribute("data-type",j.MODAL_C_MORE),W.fragment.appendChild(F)}L.replaceChildren(W.fragment)}else L.replaceChildren()},DOMMSimilarFill(z,K,Q,V){var X=Q.children[3].children.length,x=Q.children[3].children[X-2],Z=x.lastElementChild,f=V.children[5],J=z.results;if(J!=null&&0<J.length){x.setAttribute("data-display","1");var L=0;while(L<J.length){var w=J[L],$=f.cloneNode(!0);$.setAttribute("data-id",w.id);let N;if(K==="movie")N=w.title;else N=w.name;$.setAttribute("title",N),$.setAttribute("data-media",K);var{firstElementChild:_,lastElementChild:q}=$;if(_.setAttribute("alt",N),q.insertAdjacentText("beforeend",N),w.poster_path!=null&&w.poster_path.length>0)_.setAttribute("src",`https://image.tmdb.org/t/p/w200${w.poster_path}`);else _.setAttribute("data-display","0"),q.setAttribute("data-opacity","1");W.fragment.appendChild($),L+=1}Z.appendChild(W.fragment)}},DOMMCreditsFill(z,K,Q,V){var X=Q.children[3].children[5],x=Q.children[3].lastElementChild,Z=V.children[0],f=V.children[1],J=V.children[2],L=V.children[3],w=V.children[4],$,_,q,N=z.cast;if(N.length>0){q=J.cloneNode(!0),q.setAttribute("data-more","0"),q.firstElementChild.textContent="Cast:";for(var k=0;k<N.length;k+=1){var b=N[k];if(K==="movie")_=Z.cloneNode(!1),_.setAttribute("href",`${window.location.origin}/discover?${G.Q_MEDIA_TYPE}=${K}&${G.Q_CAST}=${b.id}&${G.Q_TITLE}=${b.name} Movies`);else _=L.cloneNode(!1);_.setAttribute("data-id",b.id),_.setAttribute("data-type",j.MODAL_CAST),_.textContent=b.name,q.appendChild(_)}if(N.length>3){var v=w.cloneNode(!1);v.setAttribute("class","more"),v.setAttribute("data-type",j.MODAL_C_MORE),v.textContent="more",q.appendChild(v)}X.appendChild(q),q=void 0}if(z.crew.length>0){var U=z.crew,F=W.orderCredits(U),S="",A="";for(var E=0;E<F;E+=1){var H=U[E];if(H.department!==S){if($!==void 0){if(q!==void 0)$?.appendChild(q),q=void 0;W.fragment.appendChild($)}S=H.department,$=f.cloneNode(!0),$.firstElementChild.textContent=S}if(H.job!==A){if(q!==void 0)$?.appendChild(q);A=H.job,q=J.cloneNode(!0),q.firstElementChild.textContent=`${A}:`}if(K==="movie"&&S==="Directing"&&(A==="Director"||A==="Series Director"||A==="Action Director"))_=Z.cloneNode(!0),_.setAttribute("href",`${window.location.origin}/discover?${G.Q_MEDIA_TYPE}=${K}&${G.Q_CREW}=${H.id}&${G.Q_TITLE}=${H.name} Movies`),_.setAttribute("data-id",H.id),_.setAttribute("data-type",j.MODAL_CAST);else _=L.cloneNode(!1);_.textContent=H.name,q.appendChild(_)}if($!==void 0){if(q!==void 0)$?.appendChild(q);W.fragment.appendChild($)}x?.appendChild(W.fragment)}},DOMMMovieFill(z,K){var Q=K.modal,V=K.templateModal.content.children[2],_=K.templateModal.content.children[0],X=Q.children[1],x=X.children[1].firstElementChild.firstElementChild,Z=X.children[3],f=Z.children[0],J=Z.children[1],L=Z.children[2],w=Z.children[3],$=Z.children[4],_=K.templateModal.content.children[0],q=K.templateModal.content.children[3],N=K.templateModal.content.children[4],k;if(f.textContent=z.title,w.textContent=z?.overview,z.runtime!==void 0)L.textContent=`${z.runtime} min`;if(z?.backdrop_path!=null)x.setAttribute("src",`https://image.tmdb.org/t/p/w780${z.backdrop_path}`),x.setAttribute("alt",z.title),x.setAttribute("data-display","1");if(z.genres.length>0){for(var b of z.genres)k=_.cloneNode(!0),k.textContent=b.name,k.setAttribute("href",`${window.location.origin}/discover?${G.Q_MEDIA_TYPE}=movie&${G.Q_GENRE}=${b.id}&${G.Q_TITLE}=${encodeURIComponent(b.name)} Movies`),k.setAttribute("data-id",b.id),k.setAttribute("data-type",j.MODAL_GENRE),W.fragment.appendChild(k);J.appendChild(W.fragment)}var v=V.cloneNode(!0);v.firstElementChild.textContent="Popularity:",k=q.cloneNode(!0),k.textContent=String(z.popularity),v.appendChild(k),$?.appendChild(v);var U=V.cloneNode(!0);if(U.firstElementChild.textContent="Release Date:",k=q.cloneNode(!0),k.textContent=z.release_date,U.appendChild(k),$?.appendChild(U),z.spoken_languages.length>0){var F=V.cloneNode(!0);F.firstElementChild.textContent="Languages:";for(var S of z.spoken_languages){if(k=q.cloneNode(!0),S.name.length>0)k.textContent=S.name;else k.textContent=S.english_name;F.appendChild(k)}$?.appendChild(F)}if(z.production_countries.length>0){var A=V.cloneNode(!0);A.firstElementChild.textContent="Countries:";for(var E of z.production_countries)k=q.cloneNode(!0),k.textContent=E.name,A.appendChild(k);$?.appendChild(A)}if(z.production_companies.length>0){var A=V.cloneNode(!0);A.setAttribute("data-more","0"),A.firstElementChild.textContent="Companies:";for(var H of z.production_companies)k=_.cloneNode(!0),k.setAttribute("href",`${window.location.origin}/discover?${G.Q_MEDIA_TYPE}=movie&${G.Q_COMPANY}=${H.id}&${G.Q_TITLE}=${encodeURIComponent(H.name)} Movies`),k.setAttribute("data-type",j.MODAL_COMPANY),k.setAttribute("data-id",H.id),k.textContent=H.name,A.appendChild(k);if(z.production_companies.length>3){var B=N.cloneNode(!1);B.setAttribute("class","more"),B.setAttribute("data-type",j.MODAL_C_MORE),B.textContent="more",A.appendChild(B)}$?.appendChild(A)}},DOMMTvFill(z,K){var Q=K.modal,V=K.templateModal.content.children[2],q=K.templateModal.content.children[0],X=Q.children[0],x=X.children[1].firstElementChild.firstElementChild,Z=X.children[3],f=Z.children[0],J=Z.children[1],L=Z.children[2],w=Z.children[3],$=Z.children[4],_=Z.children[6],q=K.templateModal.content.children[0],N=K.templateModal.content.children[3],k=K.templateModal.content.children[4],b=K.templateModal.content.children[6],v=K.templateModal.content.children[7],U;if(f.textContent=z.name,w.textContent=z?.overview,L.textContent=`${z.number_of_episodes} episodes, ${z.number_of_seasons} seasons`,z?.backdrop_path!=null)x.setAttribute("src",`https://image.tmdb.org/t/p/w780${z.backdrop_path}`),x.setAttribute("alt",z.name),x.setAttribute("data-display","1");if(z.genres.length>0){for(var F of z.genres)U=q.cloneNode(!0),U.textContent=F.name,U.setAttribute("href",`${window.location.origin}/discover?${G.Q_MEDIA_TYPE}=tv&${G.Q_GENRE}=${F.id}&${G.Q_TITLE}=${encodeURIComponent(F.name)} Tv Series`),U.setAttribute("data-id",F.id),U.setAttribute("data-type",j.MODAL_GENRE),W.fragment.appendChild(U);J.appendChild(W.fragment)}var S=V.cloneNode(!0);S.firstElementChild.textContent="Popularity:",U=N.cloneNode(!0),U.textContent=String(z.popularity),S.appendChild(U),$?.appendChild(S);var A=V.cloneNode(!0);if(A.firstElementChild.textContent="First Air Date:",U=N.cloneNode(!0),U.textContent=z.first_air_date,A.appendChild(U),$.appendChild(A),z.spoken_languages.length>0){var E=V.cloneNode(!0);E.firstElementChild.textContent="Languages:";for(var H of z.spoken_languages){if(U=N.cloneNode(!0),H.name.length>0)U.textContent=H.name;else U.textContent=H.english_name;E.appendChild(U)}$?.appendChild(E)}if(z.production_countries.length>0){var B=V.cloneNode(!0);B.firstElementChild.textContent="Countries:";for(var m of z.production_countries)U=N.cloneNode(!0),U.textContent=m.name,B.appendChild(U);$?.appendChild(B)}if(z.production_companies.length>0){var B=V.cloneNode(!0);B.setAttribute("data-more","0"),B.firstElementChild.textContent="Companies:";for(var y of z.production_companies)U=q.cloneNode(!0),U.setAttribute("href",`${window.location.origin}/discover?${G.Q_MEDIA_TYPE}=tv&${G.Q_COMPANY}=${y.id}&${G.Q_TITLE}=${encodeURIComponent(y.name)} Tv Series`),U.setAttribute("data-type",j.MODAL_COMPANY),U.setAttribute("data-id",y.id),U.textContent=y.name,B.appendChild(U);if(z.production_companies.length>3){var u=k.cloneNode(!1);u.setAttribute("class","more"),u.setAttribute("data-type",j.MODAL_C_MORE),u.textContent="more",B.appendChild(u)}$?.appendChild(B)}if(W.seasonNumber!==-1){var I=z.seasons,l=b.content.cloneNode(!0),p=l.children[0].lastElementChild;if(_.setAttribute("data-display","1"),I.length>1)for(let s=0;s<I.length;s+=1){var T=I[s].season_number,c=v.cloneNode(!1);if(T===1)c.setAttribute("selected","true");c.textContent=`Season ${T}`,c.setAttribute("value",String(T)),p.appendChild(c)}else p.setAttribute("data-display","0");_.appendChild(l)}},close(z){if(!W.dataLoaded||!W.creditsLoaded||!W.similarLoaded||!W.seasonLoaded)o("The modal is closed");var K;if(W.mediaType==="tv")K=z.modal.children[0];else K=z.modal.children[1];var Q=K.children[1].firstElementChild?.firstElementChild,V=K.children[3];Q?.setAttribute("data-display","0"),Q?.setAttribute("src",""),Q?.setAttribute("alt","");var X=V.children.length;if(V.children[0].replaceChildren(),V.children[1].replaceChildren(),V.children[2].replaceChildren(),V.children[3].replaceChildren(),V.children[4].replaceChildren(),V.children[5].replaceChildren(),V.lastElementChild.replaceChildren(),W.mediaType==="tv"){var x=V.children[6];x.replaceChildren(),x.setAttribute("data-display","0")}var Z=V.children[X-2];Z.setAttribute("data-display","0"),Z.lastElementChild.replaceChildren(),z.main.style.removeProperty("transform"),z.main.toggleAttribute("data-fixed"),z.modal.setAttribute("data-display","0"),document.firstElementChild.scrollTop=W.topScroll,W.isOpen=!1,W.seasonNumber=-1,W.id="",W.dataLoaded=!1,W.creditsLoaded=!1,W.similarLoaded=!1,W.seasonLoaded=!1},open(z,K,Q,V){W.topScroll=document.firstElementChild.scrollTop,document.firstElementChild.scrollTop=0,W.isOpen=!0,W.mediaType=z,W.id=K,Q.modal.setAttribute("data-display","1"),Q.modal.setAttribute("data-select",z),Q.main.style.setProperty("transform",`translateY(-${W.topScroll}px)`),Q.main.toggleAttribute("data-fixed"),W.getData(z,K,Q,V)},onchange(z,K){var Q=z.getAttribute("data-type");if(Q===j.MODAL_SEASON_N){var V=Number(z.value);if(V===NaN)return;if(V!==W.seasonNumber)W.seasonNumber=V,W.getSeason(W.id,V,K.modal.children[0],K.templateModal.content)}},onclick(z,K){var Q=z.getAttribute("data-type");if(Q===j.MODAL||Q===j.MODAL_CLOSE)W.close(K),G.pushstate(G.href);else if(Q===j.MODAL_C_MORE)z.parentElement.setAttribute("data-more","1");else if(Q===j.ITEM){var V=z?.getAttribute("data-id"),X=z?.getAttribute("data-media");W.close(K),W.open(X,V,K,!0)}}},d={TYPE:j,API:P,Theme:Y,Hero:r,Nav:C,Route:G,Item:i,Modal:W,Utils:n};export{d as default};
