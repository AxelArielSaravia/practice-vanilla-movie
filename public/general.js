var C=function($){if($.ok)return $.json()},o=function($){g.abort($),g=new AbortController,P.signal=g.signal},Y={NAV_LINK:"0",ITEM:"6",MODAL:"8",MODAL_CLOSE:"9",MODAL_GENRE:"10",MODAL_COMPANY:"11",MODAL_CAST:"12",MODAL_C_MORE:"13",MODAL_SEASON_N:"14"},p={random($){return Math.floor(Math.random()*$)},randomPermutation($){var z=$.length;for(var K=0;K<z-1;K+=1){var Q=K+Math.floor(Math.random()*(z-K)),V=$[K];$[K]=$[Q],$[Q]=V}}},L={current:"dark",DARK:"dark",LIGHT:"light",init(){var $=localStorage.getItem("theme");if($==="dark"||$==="light")L.current=$;else{if(window.matchMedia!==void 0&&window.matchMedia("(prefers-color-scheme: dark)").matches)L.current=L.DARK;else L.current=L.LIGHT;localStorage.setItem("theme",L.current)}document.firstElementChild?.setAttribute("class",L.current)},change($){localStorage.setItem("theme",$),document.firstElementChild?.setAttribute("class",L.current)},onclick($){var z=$.currentTarget;if(z===null)return;if(L.current===L.DARK)L.current=L.LIGHT;else L.current=L.DARK;z.setAttribute("data-type",L.current),L.change(L.current)}},h={getGenres($){return fetch(`${window.location.origin}/api/genres?t=${$}`).then(C)},getImages($,z){return fetch(`${window.location.origin}/api/images?t=${z}&i=${$}`).then(C)},getTrending($,z="1"){return fetch(`${window.location.origin}/api/trending?t=${$}&p=${z}`).then(C)},getPopular($,z="1"){return fetch(`${window.location.origin}/api/popular?t=${$}&p=${z}`).then(C)},getDiscover($,z="1",K,Q,V,x){var X=`${window.location.origin}/api/discover?t=${$}&p=${z}`;if(K!==void 0)X=`${X}&g=${K}`;else if(Q!==void 0)X=`${X}&ca=${Q}`;else if(V!==void 0)X=`${X}&cr=${V}`;else if(x!==void 0)X=`${X}&co=${x}`;return fetch(X).then(C)},getTopRated($,z="1"){return fetch(`${window.location.origin}/api/toprated?t=${$}&p=${z}`).then(C)},get($,z,K,Q){var V=`${window.location.origin}/api/${$}?i=${z}`;if(K)V+="&s";return fetch(V,Q).then(C)},getCredits($,z,K){return fetch(`${window.location.origin}/api/credits?t=${$}&i=${z}`,K).then(C)},getSeason($,z,K){return fetch(`${window.location.origin}/api/season?i=${$}&n=${z}`,K).then(C)},getSearch($,z="1"){return fetch(`${window.location.origin}/api/search?q=${$}&p=${z}`,option).then(C)}},S={ATTR_SHOW:"data-mbshow",HIDDEN:"0",SHOW:"1",buttonNavOnclick($){var z=$.currentTarget,K=z.nextElementSibling;if(K.getAttribute(S.ATTR_SHOW)===S.HIDDEN)K.setAttribute(S.ATTR_SHOW,S.SHOW),K.firstElementChild.firstElementChild.focus()},navOnfocusout($){var z=$.relatedTarget,K=z?.getAttribute("data-type");if(z===null||K!==Y.NAV_LINK){var Q=$.currentTarget;Q.setAttribute(S.ATTR_SHOW,S.HIDDEN)}}},r={select($){return $[p.random($.length)]},selectHero($){if($){if(!$.results||$.results.length===0)throw Error("trending.results does not have data");return r.select($.results)}},async getHeroLogo($){if($===void 0)return;var{id:z,media_type:K}=$,Q=await h.getImages(z,K);if(Q.logos.length>0)return Q.logos[0].file_path;else return},initDOMImgLogo($,z){var K=z.lastElementChild.firstElementChild;if($!==void 0)K.firstElementChild.setAttribute("data-opacity","0"),K.lastElementChild.setAttribute("data-display","1"),K.lastElementChild.setAttribute("src",`https://image.tmdb.org/t/p/w300${$}`)},initDOM($,z){var K=z.firstElementChild.firstElementChild,Q=z.lastElementChild,V=Q.firstElementChild,x=V.firstElementChild,X=Q.lastElementChild;if(K.setAttribute("data-display","1"),K.setAttribute("src",`https://image.tmdb.org/t/p/w1280${$.backdrop_path}`),$.media_type==="tv")x.insertAdjacentText("beforeend",$.name);else x.insertAdjacentText("beforeend",$.title);if(V.setAttribute("href",G.getHref($.media_type,$.id)),V.setAttribute("data-media",$.media_type),V.setAttribute("data-id",$.id),$.overview!==void 0)if($.overview.length>300){var j=$.overview.lastIndexOf(" ",300),H=`${$.overview.substring(0,j)}...`;X.insertAdjacentText("beforeend",H)}else X.insertAdjacentText("beforeend",$.overview)},DOMTitleOnclick($,z,K){K.preventDefault();var Q=$.getAttribute("data-id"),V=$.getAttribute("data-media");if(Q!==null&&V!==null)W.open(V,Q,z,!0)}},G={Q_TITLE:"tl",Q_MEDIA_TYPE:"t",Q_GENRE:"g",Q_CREW:"cr",Q_CAST:"ca",Q_COMPANY:"co",Q_ID:"i",url:new URL(window.location.href),origin:`${window.location.origin}${window.location.pathname}`,href:`${window.location.origin}${window.location.pathname}`,hrefq:`${window.location.origin}${window.location.pathname}?`,getHref($,z){return`${G.hrefq}${G.Q_MEDIA_TYPE}=${$}&${G.Q_ID}=${z}`},pushstate($){history.pushState(void 0,"",$)},init($){var z=G.url.searchParams.get(G.Q_MEDIA_TYPE),K=G.url.searchParams.get(G.Q_ID);if(z!==null&&K!==null)if(z=="tv"||z=="movie")W.open(z,K,$,!1);else console.error(`Bad query: 'type=${z}'`)},onpopstate($){G.url.href=window.location.href;var z=G.url.searchParams.get(G.Q_MEDIA_TYPE),K=G.url.searchParams.get(G.Q_ID);if(W.isOpen)W.close($);if(K!==null&&(z==="tv"||z==="movie"))W.open(z,K,$,!1)}},i={createDOMItem($,z,K){if(z==="all")z=$.media_type;var Q=K.cloneNode(!0),V;if(z==="movie")V=$.title;else V=$.name;return Q.setAttribute("data-id",$.id),Q.setAttribute("title",V),Q.setAttribute("href",G.getHref(z,$.id)),Q.setAttribute("data-media",z),Q.lastElementChild.insertAdjacentText("beforeend",V),Q.firstElementChild.setAttribute("alt",V),i.setImage(h.getImages($.id,z),Q,$.backdrop_path),Q},async setImage($,z,K){var Q=await $,V=z.firstElementChild;if(Q===void 0||Q.backdrops===void 0||Q.backdrops.length===0){if(K!==null&&K.length>0)V.setAttribute("src",`https://image.tmdb.org/t/p/w400${K}`),V.setAttribute("data-display","1"),z.lastElementChild?.setAttribute("data-opacity","0")}else{var x=Q.backdrops[0];V.setAttribute("src",`https://image.tmdb.org/t/p/w400${x.file_path}`),V.setAttribute("data-display","1"),z.lastElementChild?.setAttribute("data-opacity","0")}}},g=new AbortController,P={signal:g.signal},W={fragment:document.createDocumentFragment(),topScroll:0,id:"",isOpen:!1,mediaType:"tv",creditsLoaded:!1,dataLoaded:!1,similarLoaded:!1,seasonLoaded:!1,seasonNumber:-1,async getCredit($,z,K,Q){var V=await h.getCredits($,z,P);if(console.info("credits:",V),V===void 0)return;W.DOMMCreditsFill(V,$,K,Q),W.creditsLoaded=!0},async getData($,z,K,Q){var V;try{V=await h.get($,z,!1,P)}catch{W.close(K);return}if(console.info("data:",V),V===void 0){W.close(K);return}if(Q)G.pushstate(G.getHref($,z));if($==="tv"){var x=K.modal.children[0];W.getCredit($,z,x,K.templateModal.content),W.getSimilar($,z,x,K.templateModal.content);var X=V.seasons;if(X.length>0){var j=!1;for(var H of X)if(H.season_number===1){j=!0;break}if(j)W.seasonNumber=1;else W.seasonNumber=X[0].season_number;W.getSeason(z,W.seasonNumber,x,K.templateModal.content)}else W.seasonNumber=-1;W.DOMMTvFill(V,K)}else{var N=K.modal.children[1];W.getCredit($,z,N,K.templateModal.content),W.getSimilar($,z,N,K.templateModal.content),W.DOMMMovieFill(V,K)}W.dataLoaded=!0},async getSeason($,z,K,Q){var V=await h.getSeason($,z,P);if(console.info("season:",V),V===void 0)return;W.DOMSeasonFill(V,K,Q),W.seasonLoaded=!0},async getSimilar($,z,K,Q){var V=await h.get($,z,!0,P);if(console.info("similars:",V),V===void 0)return;W.DOMMSimilarFill(V,$,K,Q),W.similarLoaded=!0},orderCredits($){if($.length<2)return $.length;var z=0,K=0,Q=0,V=1;for(var x=1;x<$.length;x+=1){var X=$[x];if(X.department!=="Crew"){while(z<=K){if(z<K)Q=Math.floor((z+K)/2);else Q=z;if(X.department<$[Q].department)K=Q-1;else if(X.department>$[Q].department)z=Q+1;else if(X.job<$[Q].job)K=Q-1;else z=Q+1}if(z!==V)$.copyWithin(z+1,z,V);$[z]=X,z=0,K=V,V+=1}}return V},DOMSeasonFill($,z,K){var Q=z.children[3].children[6],V=K.children[8],x=K.children[4],X=Q.firstElementChild.firstElementChild,j=Q.children[1],H=Q.children[2],N=Q.children[3];if(N.setAttribute("data-more","0"),X.textContent=`${$.episodes.length} episodes`,j.textContent=$.name,H.textContent=$.overview,$.episodes.length>0){var w=$.episodes;for(var Z of w){var _=V.cloneNode(!0),q=_.children[0].firstElementChild,k=_.children[1],f=_.children[2].children[0],v=_.children[2].children[1],B=_.children[2].children[2],U=_.children[2].children[3];if(Z.still_path!==null)q.setAttribute("src",`https://image.tmdb.org/t/p/w400${Z.still_path}`),q.setAttribute("alt",Z.name);if(f.textContent=Z.air_date,k.textContent=Z.episode_number,v.textContent=Z.name,Z.runtime!==null)B.textContent=`${Z.runtime} min`;U.textContent=Z.overview,W.fragment.appendChild(_)}if($.episodes.length>4){var F=x.cloneNode(!0);F.textContent="more +",F.setAttribute("data-type",Y.MODAL_C_MORE),W.fragment.appendChild(F)}N.replaceChildren(W.fragment)}else N.replaceChildren()},DOMMSimilarFill($,z,K,Q){var V=K.children[3].children.length,x=K.children[3].children[V-2],X=x.lastElementChild,j=Q.children[5],H=$.results;if(H!=null&&0<H.length){x.setAttribute("data-display","1");var N=0;while(N<H.length){var w=H[N],Z=j.cloneNode(!0);Z.setAttribute("data-id",w.id);let k;if(z==="movie")k=w.title;else k=w.name;Z.setAttribute("title",k),Z.setAttribute("data-media",z);var{firstElementChild:_,lastElementChild:q}=Z;if(_.setAttribute("alt",k),q.insertAdjacentText("beforeend",k),w.poster_path!=null&&w.poster_path.length>0)_.setAttribute("src",`https://image.tmdb.org/t/p/w200${w.poster_path}`);else _.setAttribute("data-display","0"),q.setAttribute("data-opacity","1");W.fragment.appendChild(Z),N+=1}X.appendChild(W.fragment)}},DOMMCreditsFill($,z,K,Q){var V=K.children[3].children[5],x=K.children[3].lastElementChild,X=Q.children[0],j=Q.children[1],H=Q.children[2],N=Q.children[3],w=Q.children[4],Z,_,q,k=$.cast;if(k.length>0){q=H.cloneNode(!0),q.setAttribute("data-more","0"),q.firstElementChild.textContent="Cast:";for(var f=0;f<k.length;f+=1){var v=k[f];if(z==="movie")_=X.cloneNode(!1),_.setAttribute("href",`${window.location.origin}/discover?${G.Q_MEDIA_TYPE}=${z}&${G.Q_CAST}=${v.id}&${G.Q_TITLE}=${v.name} Movies`);else _=N.cloneNode(!1);_.setAttribute("data-id",v.id),_.setAttribute("data-type",Y.MODAL_CAST),_.textContent=v.name,q.appendChild(_)}if(k.length>3){var B=w.cloneNode(!1);B.setAttribute("class","more"),B.setAttribute("data-type",Y.MODAL_C_MORE),B.textContent="more",q.appendChild(B)}V.appendChild(q),q=void 0}if($.crew.length>0){var U=$.crew,F=W.orderCredits(U),E="",A="";for(var R=0;R<F;R+=1){var J=U[R];if(J.department!==E){if(Z!==void 0){if(q!==void 0)Z?.appendChild(q),q=void 0;W.fragment.appendChild(Z)}E=J.department,Z=j.cloneNode(!0),Z.firstElementChild.textContent=E}if(J.job!==A){if(q!==void 0)Z?.appendChild(q);A=J.job,q=H.cloneNode(!0),q.firstElementChild.textContent=`${A}:`}if(z==="movie"&&E==="Directing"&&(A==="Director"||A==="Series Director"||A==="Action Director"))_=X.cloneNode(!0),_.setAttribute("href",`${window.location.origin}/discover?${G.Q_MEDIA_TYPE}=${z}&${G.Q_CREW}=${J.id}&${G.Q_TITLE}=${J.name} Movies`),_.setAttribute("data-id",J.id),_.setAttribute("data-type",Y.MODAL_CAST);else _=N.cloneNode(!1);_.textContent=J.name,q.appendChild(_)}if(Z!==void 0){if(q!==void 0)Z?.appendChild(q);W.fragment.appendChild(Z)}x?.appendChild(W.fragment)}},DOMMMovieFill($,z){var K=z.modal,Q=z.templateModal.content.children[2],_=z.templateModal.content.children[0],V=K.children[1],x=V.children[1].firstElementChild.firstElementChild,X=V.children[3],j=X.children[0],H=X.children[1],N=X.children[2],w=X.children[3],Z=X.children[4],_=z.templateModal.content.children[0],q=z.templateModal.content.children[3],k=z.templateModal.content.children[4],f;if(j.textContent=$.title,w.textContent=$?.overview,$.runtime!==void 0)N.textContent=`${$.runtime} min`;if($?.backdrop_path!=null)x.setAttribute("src",`https://image.tmdb.org/t/p/w780${$.backdrop_path}`),x.setAttribute("alt",$.title),x.setAttribute("data-display","1");if($.genres.length>0){for(var v of $.genres)f=_.cloneNode(!0),f.textContent=v.name,f.setAttribute("href",`${window.location.origin}/discover?${G.Q_MEDIA_TYPE}=movie&${G.Q_GENRE}=${v.id}&${G.Q_TITLE}=${encodeURIComponent(v.name)} Movies`),f.setAttribute("data-id",v.id),f.setAttribute("data-type",Y.MODAL_GENRE),W.fragment.appendChild(f);H.appendChild(W.fragment)}var B=Q.cloneNode(!0);B.firstElementChild.textContent="Popularity:",f=q.cloneNode(!0),f.textContent=String($.popularity),B.appendChild(f),Z?.appendChild(B);var U=Q.cloneNode(!0);if(U.firstElementChild.textContent="Release Date:",f=q.cloneNode(!0),f.textContent=$.release_date,U.appendChild(f),Z?.appendChild(U),$.spoken_languages.length>0){var F=Q.cloneNode(!0);F.firstElementChild.textContent="Languages:";for(var E of $.spoken_languages){if(f=q.cloneNode(!0),E.name.length>0)f.textContent=E.name;else f.textContent=E.english_name;F.appendChild(f)}Z?.appendChild(F)}if($.production_countries.length>0){var A=Q.cloneNode(!0);A.firstElementChild.textContent="Countries:";for(var R of $.production_countries)f=q.cloneNode(!0),f.textContent=R.name,A.appendChild(f);Z?.appendChild(A)}if($.production_companies.length>0){var A=Q.cloneNode(!0);A.setAttribute("data-more","0"),A.firstElementChild.textContent="Companies:";for(var J of $.production_companies)f=_.cloneNode(!0),f.setAttribute("href",`${window.location.origin}/discover?${G.Q_MEDIA_TYPE}=movie&${G.Q_COMPANY}=${J.id}&${G.Q_TITLE}=${encodeURIComponent(J.name)} Movies`),f.setAttribute("data-type",Y.MODAL_COMPANY),f.setAttribute("data-id",J.id),f.textContent=J.name,A.appendChild(f);if($.production_companies.length>3){var b=k.cloneNode(!1);b.setAttribute("class","more"),b.setAttribute("data-type",Y.MODAL_C_MORE),b.textContent="more",A.appendChild(b)}Z?.appendChild(A)}},DOMMTvFill($,z){var K=z.modal,Q=z.templateModal.content.children[2],q=z.templateModal.content.children[0],V=K.children[0],x=V.children[1].firstElementChild.firstElementChild,X=V.children[3],j=X.children[0],H=X.children[1],N=X.children[2],w=X.children[3],Z=X.children[4],_=X.children[6],q=z.templateModal.content.children[0],k=z.templateModal.content.children[3],f=z.templateModal.content.children[4],v=z.templateModal.content.children[6],B=z.templateModal.content.children[7],U;if(j.textContent=$.name,w.textContent=$?.overview,N.textContent=`${$.number_of_episodes} episodes, ${$.number_of_seasons} seasons`,$?.backdrop_path!=null)x.setAttribute("src",`https://image.tmdb.org/t/p/w780${$.backdrop_path}`),x.setAttribute("alt",$.name),x.setAttribute("data-display","1");if($.genres.length>0){for(var F of $.genres)U=q.cloneNode(!0),U.textContent=F.name,U.setAttribute("href",`${window.location.origin}/discover?${G.Q_MEDIA_TYPE}=tv&${G.Q_GENRE}=${F.id}&${G.Q_TITLE}=${encodeURIComponent(F.name)} Tv Series`),U.setAttribute("data-id",F.id),U.setAttribute("data-type",Y.MODAL_GENRE),W.fragment.appendChild(U);H.appendChild(W.fragment)}var E=Q.cloneNode(!0);E.firstElementChild.textContent="Popularity:",U=k.cloneNode(!0),U.textContent=String($.popularity),E.appendChild(U),Z?.appendChild(E);var A=Q.cloneNode(!0);if(A.firstElementChild.textContent="First Air Date:",U=k.cloneNode(!0),U.textContent=$.first_air_date,A.appendChild(U),Z.appendChild(A),$.spoken_languages.length>0){var R=Q.cloneNode(!0);R.firstElementChild.textContent="Languages:";for(var J of $.spoken_languages){if(U=k.cloneNode(!0),J.name.length>0)U.textContent=J.name;else U.textContent=J.english_name;R.appendChild(U)}Z?.appendChild(R)}if($.production_countries.length>0){var b=Q.cloneNode(!0);b.firstElementChild.textContent="Countries:";for(var m of $.production_countries)U=k.cloneNode(!0),U.textContent=m.name,b.appendChild(U);Z?.appendChild(b)}if($.production_companies.length>0){var b=Q.cloneNode(!0);b.setAttribute("data-more","0"),b.firstElementChild.textContent="Companies:";for(var u of $.production_companies)U=q.cloneNode(!0),U.setAttribute("href",`${window.location.origin}/discover?${G.Q_MEDIA_TYPE}=tv&${G.Q_COMPANY}=${u.id}&${G.Q_TITLE}=${encodeURIComponent(u.name)} Tv Series`),U.setAttribute("data-type",Y.MODAL_COMPANY),U.setAttribute("data-id",u.id),U.textContent=u.name,b.appendChild(U);if($.production_companies.length>3){var c=f.cloneNode(!1);c.setAttribute("class","more"),c.setAttribute("data-type",Y.MODAL_C_MORE),c.textContent="more",b.appendChild(c)}Z?.appendChild(b)}if(W.seasonNumber!==-1){var I=$.seasons,n=v.content.cloneNode(!0),s=n.children[0].lastElementChild;if(_.setAttribute("data-display","1"),I.length>1)for(let l=0;l<I.length;l+=1){var T=I[l].season_number,y=B.cloneNode(!1);if(T===1)y.setAttribute("selected","true");y.textContent=`Season ${T}`,y.setAttribute("value",String(T)),s.appendChild(y)}else s.setAttribute("data-display","0");_.appendChild(n)}},close($){if(!W.dataLoaded||!W.creditsLoaded||!W.similarLoaded||!W.seasonLoaded)o("The modal is closed");var z;if(W.mediaType==="tv")z=$.modal.children[0];else z=$.modal.children[1];var K=z.children[1].firstElementChild?.firstElementChild,Q=z.children[3];K?.setAttribute("data-display","0"),K?.setAttribute("src",""),K?.setAttribute("alt","");var V=Q.children.length;if(Q.children[0].replaceChildren(),Q.children[1].replaceChildren(),Q.children[2].replaceChildren(),Q.children[3].replaceChildren(),Q.children[4].replaceChildren(),Q.children[5].replaceChildren(),Q.lastElementChild.replaceChildren(),W.mediaType==="tv"){var x=Q.children[6];x.replaceChildren(),x.setAttribute("data-display","0")}var X=Q.children[V-2];X.setAttribute("data-display","0"),X.lastElementChild.replaceChildren(),$.main.style.removeProperty("transform"),$.main.toggleAttribute("data-fixed"),$.modal.setAttribute("data-display","0"),document.firstElementChild.scrollTop=W.topScroll,W.isOpen=!1,W.seasonNumber=-1,W.id="",W.dataLoaded=!1,W.creditsLoaded=!1,W.similarLoaded=!1,W.seasonLoaded=!1},open($,z,K,Q){W.topScroll=document.firstElementChild.scrollTop,document.firstElementChild.scrollTop=0,W.isOpen=!0,W.mediaType=$,W.id=z,K.modal.setAttribute("data-display","1"),K.modal.setAttribute("data-select",$),K.main.style.setProperty("transform",`translateY(-${W.topScroll}px)`),K.main.toggleAttribute("data-fixed"),W.getData($,z,K,Q)},onchange($,z){var K=$.getAttribute("data-type");if(K===Y.MODAL_SEASON_N){var Q=Number($.value);if(Q===NaN)return;if(Q!==W.seasonNumber)W.seasonNumber=Q,W.getSeason(W.id,Q,z.modal.children[0],z.templateModal.content)}},onclick($,z){var K=$.getAttribute("data-type");if(K===Y.MODAL||K===Y.MODAL_CLOSE)W.close(z),G.pushstate(G.href);else if(K===Y.MODAL_C_MORE)$.parentElement.setAttribute("data-more","1");else if(K===Y.ITEM){var Q=$?.getAttribute("data-id"),V=$?.getAttribute("data-media");W.close(z),W.open(V,Q,z,!0)}}},d={TYPE:Y,API:h,Theme:L,Hero:r,Nav:S,Route:G,Item:i,Modal:W,Utils:p};export{d as default};
