var C=function($){if($.ok)return $.json()},o=function($){g.abort($),g=new AbortController,P.signal=g.signal},J={NAV_LINK:"0",ITEM:"6",MODAL:"8",MODAL_CLOSE:"9",MODAL_GENRE:"10",MODAL_COMPANY:"11",MODAL_CAST:"12",MODAL_C_MORE:"13",MODAL_SEASON_N:"14"},p={random($){return Math.floor(Math.random()*$)},randomPermutation($){var Q=$.length;for(var W=0;W<Q-1;W+=1){var z=W+Math.floor(Math.random()*(Q-W)),V=$[W];$[W]=$[z],$[z]=V}}},k={current:"dark",DARK:"dark",LIGHT:"light",init(){var $=localStorage.getItem("theme");if($==="dark"||$==="light")k.current=$;else{if(window.matchMedia!==void 0&&window.matchMedia("(prefers-color-scheme: dark)").matches)k.current=k.DARK;else k.current=k.LIGHT;localStorage.setItem("theme",k.current)}document.firstElementChild?.setAttribute("class",k.current)},change($){localStorage.setItem("theme",$),document.firstElementChild?.setAttribute("class",k.current)},onclick($){var Q=$.currentTarget;if(Q===null)return;if(k.current===k.DARK)k.current=k.LIGHT;else k.current=k.DARK;Q.setAttribute("data-type",k.current),k.change(k.current)}},h={getGenres($){return fetch(`${window.location.origin}/api/genres?t=${$}`).then(C)},getImages($,Q){return fetch(`${window.location.origin}/api/images?t=${Q}&i=${$}`).then(C)},getTrending($,Q="1"){return fetch(`${window.location.origin}/api/trending?t=${$}&p=${Q}`).then(C)},getPopular($,Q="1"){return fetch(`${window.location.origin}/api/popular?t=${$}&p=${Q}`).then(C)},getDiscover($,Q="1",W,z,V,U){var X=`${window.location.origin}/api/discover?t=${$}&p=${Q}`;if(W!==void 0)X=`${X}&g=${W}`;else if(z!==void 0)X=`${X}&ca=${z}`;else if(V!==void 0)X=`${X}&cr=${V}`;else if(U!==void 0)X=`${X}&co=${U}`;return fetch(X).then(C)},getTopRated($,Q="1"){return fetch(`${window.location.origin}/api/toprated?t=${$}&p=${Q}`).then(C)},get($,Q,W,z){var V=`${window.location.origin}/api/${$}?i=${Q}`;if(W)V+="&s";return fetch(V,z).then(C)},getCredits($,Q,W){return fetch(`${window.location.origin}/api/credits?t=${$}&i=${Q}`,W).then(C)},getSeason($,Q,W){return fetch(`${window.location.origin}/api/season?i=${$}&n=${Q}`,W).then(C)},getSearch($,Q="1"){return fetch(`${window.location.origin}/api/search?q=${$}&p=${Q}`).then(C)}},R={ATTR_SHOW:"data-mbshow",HIDDEN:"0",SHOW:"1",buttonNavOnclick($){var Q=$.currentTarget,W=Q.nextElementSibling;if(W.getAttribute(R.ATTR_SHOW)===R.HIDDEN)W.setAttribute(R.ATTR_SHOW,R.SHOW),W.firstElementChild.firstElementChild.focus()},navOnfocusout($){var Q=$.relatedTarget,W=Q?.getAttribute("data-type");if(Q===null||W!==J.NAV_LINK){var z=$.currentTarget;z.setAttribute(R.ATTR_SHOW,R.HIDDEN)}}},r={select($){return $[p.random($.length)]},selectHero($){if($){if(!$.results||$.results.length===0)throw Error("trending.results does not have data");return r.select($.results)}},async getHeroLogo($){if($===void 0)return;var{id:Q,media_type:W}=$,z=await h.getImages(Q,W);if(z.logos.length>0)return z.logos[0].file_path;else return},initDOMImgLogo($,Q){var W=Q.lastElementChild.firstElementChild;if($!==void 0)W.firstElementChild.setAttribute("data-opacity","0"),W.lastElementChild.setAttribute("data-display","1"),W.lastElementChild.setAttribute("src",`https://image.tmdb.org/t/p/w300${$}`)},initDOM($,Q){var W=Q.firstElementChild.firstElementChild,z=Q.lastElementChild,V=z.firstElementChild,U=V.firstElementChild,X=z.lastElementChild;if(W.setAttribute("data-display","1"),W.setAttribute("src",`https://image.tmdb.org/t/p/w1280${$.backdrop_path}`),$.media_type==="tv")U.insertAdjacentText("beforeend",$.name);else U.insertAdjacentText("beforeend",$.title);if(V.setAttribute("href",x.getHref($.media_type,$.id)),V.setAttribute("data-media",$.media_type),V.setAttribute("data-id",$.id),$.overview!==void 0)if($.overview.length>300){var j=$.overview.lastIndexOf(" ",300),H=`${$.overview.substring(0,j)}...`;X.insertAdjacentText("beforeend",H)}else X.insertAdjacentText("beforeend",$.overview)},DOMTitleOnclick($,Q,W){W.preventDefault();var z=$.getAttribute("data-id"),V=$.getAttribute("data-media");if(z!==null&&V!==null)K.open(V,z,Q,!0)}},x={Q_TITLE:"tl",Q_MEDIA_TYPE:"t",Q_GENRE:"g",Q_CREW:"cr",Q_CAST:"ca",Q_COMPANY:"co",Q_ID:"i",Q_SEARCH:"q",url:new URL(window.location.href),origin:`${window.location.origin}${window.location.pathname}`,href:`${window.location.origin}${window.location.pathname}`,hrefq:`${window.location.origin}${window.location.pathname}?`,getHref($,Q){return`${x.hrefq}${x.Q_MEDIA_TYPE}=${$}&${x.Q_ID}=${Q}`},pushstate($){history.pushState(void 0,"",$)},init($){var Q=x.url.searchParams.get(x.Q_MEDIA_TYPE),W=x.url.searchParams.get(x.Q_ID);if(Q!==null&&W!==null)if(Q=="tv"||Q=="movie")K.open(Q,W,$,!1);else console.error(`Bad query: 'type=${Q}'`)},onpopstate($){x.url.href=window.location.href;var Q=x.url.searchParams.get(x.Q_MEDIA_TYPE),W=x.url.searchParams.get(x.Q_ID);if(K.isOpen)K.close($);if(W!==null&&(Q==="tv"||Q==="movie"))K.open(Q,W,$,!1)}},i={createDOMItem($,Q,W){if(Q==="all")Q=$.media_type;var z=W.cloneNode(!0),V;if(Q==="movie")V=$.title;else V=$.name;return z.setAttribute("data-id",$.id),z.setAttribute("title",V),z.setAttribute("href",x.getHref(Q,$.id)),z.setAttribute("data-media",Q),z.lastElementChild.insertAdjacentText("beforeend",V),z.firstElementChild.setAttribute("alt",V),i.setImage(h.getImages($.id,Q),z,$.backdrop_path),z},async setImage($,Q,W){var z=await $,V=Q.firstElementChild;if(z===void 0||z.backdrops===void 0||z.backdrops.length===0){if(W!==null&&W.length>0)V.setAttribute("src",`https://image.tmdb.org/t/p/w400${W}`),V.setAttribute("data-display","1"),Q.lastElementChild?.setAttribute("data-opacity","0")}else{var U=z.backdrops[0];V.setAttribute("src",`https://image.tmdb.org/t/p/w400${U.file_path}`),V.setAttribute("data-display","1"),Q.lastElementChild?.setAttribute("data-opacity","0")}}},g=new AbortController,P={signal:g.signal},K={fragment:document.createDocumentFragment(),topScroll:0,id:"",isOpen:!1,mediaType:"tv",creditsLoaded:!1,dataLoaded:!1,similarLoaded:!1,seasonLoaded:!1,seasonNumber:-1,async getCredit($,Q,W,z){var V=await h.getCredits($,Q,P);if(V===void 0)return;K.DOMMCreditsFill(V,$,W,z),K.creditsLoaded=!0},async getData($,Q,W,z){var V;try{V=await h.get($,Q,!1,P)}catch{K.close(W);return}if(V===void 0){K.close(W);return}if(z)x.pushstate(x.getHref($,Q));if($==="tv"){var U=W.modal.children[0];K.getCredit($,Q,U,W.templateModal.content),K.getSimilar($,Q,U,W.templateModal.content);var X=V.seasons;if(X.length>0){var j=!1;for(var H of X)if(H.season_number===1){j=!0;break}if(j)K.seasonNumber=1;else K.seasonNumber=X[0].season_number;K.getSeason(Q,K.seasonNumber,U,W.templateModal.content)}else K.seasonNumber=-1;K.DOMMTvFill(V,W)}else{var A=W.modal.children[1];K.getCredit($,Q,A,W.templateModal.content),K.getSimilar($,Q,A,W.templateModal.content),K.DOMMMovieFill(V,W)}K.dataLoaded=!0},async getSeason($,Q,W,z){var V=await h.getSeason($,Q,P);if(V===void 0)return;K.DOMSeasonFill(V,W,z),K.seasonLoaded=!0},async getSimilar($,Q,W,z){var V=await h.get($,Q,!0,P);if(V===void 0)return;K.DOMMSimilarFill(V,$,W,z),K.similarLoaded=!0},orderCredits($){if($.length<2)return $.length;var Q=0,W=0,z=0,V=1;for(var U=1;U<$.length;U+=1){var X=$[U];if(X.department!=="Crew"){while(Q<=W){if(Q<W)z=Math.floor((Q+W)/2);else z=Q;if(X.department<$[z].department)W=z-1;else if(X.department>$[z].department)Q=z+1;else if(X.job<$[z].job)W=z-1;else Q=z+1}if(Q!==V)$.copyWithin(Q+1,Q,V);$[Q]=X,Q=0,W=V,V+=1}}return V},DOMSeasonFill($,Q,W){var z=Q.children[3].children[6],V=W.children[8],U=W.children[4],X=z.firstElementChild.firstElementChild,j=z.children[1],H=z.children[2],A=z.children[3];if(A.setAttribute("data-more","0"),X.textContent=`${$.episodes.length} episodes`,j.textContent=$.name,H.textContent=$.overview,$.episodes.length>0){var w=$.episodes;for(var Z of w){var _=V.cloneNode(!0),f=_.children[0].firstElementChild,N=_.children[1],L=_.children[2].children[0],v=_.children[2].children[1],B=_.children[2].children[2],G=_.children[2].children[3];if(Z.still_path!==null)f.setAttribute("src",`https://image.tmdb.org/t/p/w400${Z.still_path}`),f.setAttribute("alt",Z.name);if(L.textContent=Z.air_date,N.textContent=Z.episode_number,v.textContent=Z.name,Z.runtime!==null)B.textContent=`${Z.runtime} min`;G.textContent=Z.overview,K.fragment.appendChild(_)}if($.episodes.length>4){var F=U.cloneNode(!0);F.textContent="more +",F.setAttribute("data-type",J.MODAL_C_MORE),K.fragment.appendChild(F)}A.replaceChildren(K.fragment)}else A.replaceChildren()},DOMMSimilarFill($,Q,W,z){var V=W.children[3].children.length,U=W.children[3].children[V-2],X=U.lastElementChild,j=z.children[5],H=$.results;if(H!=null&&0<H.length){U.setAttribute("data-display","1");var A=0;while(A<H.length){var w=H[A],Z=j.cloneNode(!0);Z.setAttribute("data-id",w.id);let N;if(Q==="movie")N=w.title;else N=w.name;Z.setAttribute("title",N),Z.setAttribute("data-media",Q);var{firstElementChild:_,lastElementChild:f}=Z;if(_.setAttribute("alt",N),f.insertAdjacentText("beforeend",N),w.poster_path!=null&&w.poster_path.length>0)_.setAttribute("src",`https://image.tmdb.org/t/p/w200${w.poster_path}`);else _.setAttribute("data-display","0"),f.setAttribute("data-opacity","1");K.fragment.appendChild(Z),A+=1}X.appendChild(K.fragment)}},DOMMCreditsFill($,Q,W,z){var V=W.children[3].children[5],U=W.children[3].lastElementChild,X=z.children[0],j=z.children[1],H=z.children[2],A=z.children[3],w=z.children[4],Z,_,f,N=$.cast;if(N.length>0){f=H.cloneNode(!0),f.setAttribute("data-more","0"),f.firstElementChild.textContent="Cast:";for(var L=0;L<N.length;L+=1){var v=N[L];if(Q==="movie")_=X.cloneNode(!1),_.setAttribute("href",`${window.location.origin}/discover?${x.Q_MEDIA_TYPE}=${Q}&${x.Q_CAST}=${v.id}&${x.Q_TITLE}=${v.name} Movies`);else _=A.cloneNode(!1);_.setAttribute("data-id",v.id),_.setAttribute("data-type",J.MODAL_CAST),_.textContent=v.name,f.appendChild(_)}if(N.length>3){var B=w.cloneNode(!1);B.setAttribute("class","more"),B.setAttribute("data-type",J.MODAL_C_MORE),B.textContent="more",f.appendChild(B)}V.appendChild(f),f=void 0}if($.crew.length>0){var G=$.crew,F=K.orderCredits(G),E="",q="";for(var S=0;S<F;S+=1){var Y=G[S];if(Y.department!==E){if(Z!==void 0){if(f!==void 0)Z?.appendChild(f),f=void 0;K.fragment.appendChild(Z)}E=Y.department,Z=j.cloneNode(!0),Z.firstElementChild.textContent=E}if(Y.job!==q){if(f!==void 0)Z?.appendChild(f);q=Y.job,f=H.cloneNode(!0),f.firstElementChild.textContent=`${q}:`}if(Q==="movie"&&E==="Directing"&&(q==="Director"||q==="Series Director"||q==="Action Director"))_=X.cloneNode(!0),_.setAttribute("href",`${window.location.origin}/discover?${x.Q_MEDIA_TYPE}=${Q}&${x.Q_CREW}=${Y.id}&${x.Q_TITLE}=${Y.name} Movies`),_.setAttribute("data-id",Y.id),_.setAttribute("data-type",J.MODAL_CAST);else _=A.cloneNode(!1);_.textContent=Y.name,f.appendChild(_)}if(Z!==void 0){if(f!==void 0)Z?.appendChild(f);K.fragment.appendChild(Z)}U?.appendChild(K.fragment)}},DOMMMovieFill($,Q){var W=Q.modal,z=Q.templateModal.content.children[2],_=Q.templateModal.content.children[0],V=W.children[1],U=V.children[1].firstElementChild.firstElementChild,X=V.children[3],j=X.children[0],H=X.children[1],A=X.children[2],w=X.children[3],Z=X.children[4],_=Q.templateModal.content.children[0],f=Q.templateModal.content.children[3],N=Q.templateModal.content.children[4],L;if(j.textContent=$.title,w.textContent=$?.overview,$.runtime!==void 0)A.textContent=`${$.runtime} min`;if($?.backdrop_path!=null)U.setAttribute("src",`https://image.tmdb.org/t/p/w780${$.backdrop_path}`),U.setAttribute("alt",$.title),U.setAttribute("data-display","1");if($.genres.length>0){for(var v of $.genres)L=_.cloneNode(!0),L.textContent=v.name,L.setAttribute("href",`${window.location.origin}/discover?${x.Q_MEDIA_TYPE}=movie&${x.Q_GENRE}=${v.id}&${x.Q_TITLE}=${encodeURIComponent(v.name)} Movies`),L.setAttribute("data-id",v.id),L.setAttribute("data-type",J.MODAL_GENRE),K.fragment.appendChild(L);H.appendChild(K.fragment)}var B=z.cloneNode(!0);B.firstElementChild.textContent="Popularity:",L=f.cloneNode(!0),L.textContent=String($.popularity),B.appendChild(L),Z?.appendChild(B);var G=z.cloneNode(!0);if(G.firstElementChild.textContent="Release Date:",L=f.cloneNode(!0),L.textContent=$.release_date,G.appendChild(L),Z?.appendChild(G),$.spoken_languages.length>0){var F=z.cloneNode(!0);F.firstElementChild.textContent="Languages:";for(var E of $.spoken_languages){if(L=f.cloneNode(!0),E.name.length>0)L.textContent=E.name;else L.textContent=E.english_name;F.appendChild(L)}Z?.appendChild(F)}if($.production_countries.length>0){var q=z.cloneNode(!0);q.firstElementChild.textContent="Countries:";for(var S of $.production_countries)L=f.cloneNode(!0),L.textContent=S.name,q.appendChild(L);Z?.appendChild(q)}if($.production_companies.length>0){var q=z.cloneNode(!0);q.setAttribute("data-more","0"),q.firstElementChild.textContent="Companies:";for(var Y of $.production_companies)L=_.cloneNode(!0),L.setAttribute("href",`${window.location.origin}/discover?${x.Q_MEDIA_TYPE}=movie&${x.Q_COMPANY}=${Y.id}&${x.Q_TITLE}=${encodeURIComponent(Y.name)} Movies`),L.setAttribute("data-type",J.MODAL_COMPANY),L.setAttribute("data-id",Y.id),L.textContent=Y.name,q.appendChild(L);if($.production_companies.length>3){var b=N.cloneNode(!1);b.setAttribute("class","more"),b.setAttribute("data-type",J.MODAL_C_MORE),b.textContent="more",q.appendChild(b)}Z?.appendChild(q)}},DOMMTvFill($,Q){var W=Q.modal,z=Q.templateModal.content.children[2],f=Q.templateModal.content.children[0],V=W.children[0],U=V.children[1].firstElementChild.firstElementChild,X=V.children[3],j=X.children[0],H=X.children[1],A=X.children[2],w=X.children[3],Z=X.children[4],_=X.children[6],f=Q.templateModal.content.children[0],N=Q.templateModal.content.children[3],L=Q.templateModal.content.children[4],v=Q.templateModal.content.children[6],B=Q.templateModal.content.children[7],G;if(j.textContent=$.name,w.textContent=$?.overview,A.textContent=`${$.number_of_episodes} episodes, ${$.number_of_seasons} seasons`,$?.backdrop_path!=null)U.setAttribute("src",`https://image.tmdb.org/t/p/w780${$.backdrop_path}`),U.setAttribute("alt",$.name),U.setAttribute("data-display","1");if($.genres.length>0){for(var F of $.genres)G=f.cloneNode(!0),G.textContent=F.name,G.setAttribute("href",`${window.location.origin}/discover?${x.Q_MEDIA_TYPE}=tv&${x.Q_GENRE}=${F.id}&${x.Q_TITLE}=${encodeURIComponent(F.name)} Tv Series`),G.setAttribute("data-id",F.id),G.setAttribute("data-type",J.MODAL_GENRE),K.fragment.appendChild(G);H.appendChild(K.fragment)}var E=z.cloneNode(!0);E.firstElementChild.textContent="Popularity:",G=N.cloneNode(!0),G.textContent=String($.popularity),E.appendChild(G),Z?.appendChild(E);var q=z.cloneNode(!0);if(q.firstElementChild.textContent="First Air Date:",G=N.cloneNode(!0),G.textContent=$.first_air_date,q.appendChild(G),Z.appendChild(q),$.spoken_languages.length>0){var S=z.cloneNode(!0);S.firstElementChild.textContent="Languages:";for(var Y of $.spoken_languages){if(G=N.cloneNode(!0),Y.name.length>0)G.textContent=Y.name;else G.textContent=Y.english_name;S.appendChild(G)}Z?.appendChild(S)}if($.production_countries.length>0){var b=z.cloneNode(!0);b.firstElementChild.textContent="Countries:";for(var m of $.production_countries)G=N.cloneNode(!0),G.textContent=m.name,b.appendChild(G);Z?.appendChild(b)}if($.production_companies.length>0){var b=z.cloneNode(!0);b.setAttribute("data-more","0"),b.firstElementChild.textContent="Companies:";for(var u of $.production_companies)G=f.cloneNode(!0),G.setAttribute("href",`${window.location.origin}/discover?${x.Q_MEDIA_TYPE}=tv&${x.Q_COMPANY}=${u.id}&${x.Q_TITLE}=${encodeURIComponent(u.name)} Tv Series`),G.setAttribute("data-type",J.MODAL_COMPANY),G.setAttribute("data-id",u.id),G.textContent=u.name,b.appendChild(G);if($.production_companies.length>3){var c=L.cloneNode(!1);c.setAttribute("class","more"),c.setAttribute("data-type",J.MODAL_C_MORE),c.textContent="more",b.appendChild(c)}Z?.appendChild(b)}if(K.seasonNumber!==-1){var T=$.seasons,s=v.content.cloneNode(!0),n=s.children[0].lastElementChild;if(_.setAttribute("data-display","1"),T.length>1)for(let l=0;l<T.length;l+=1){var I=T[l].season_number,y=B.cloneNode(!1);if(I===1)y.setAttribute("selected","true");y.textContent=`Season ${I}`,y.setAttribute("value",String(I)),n.appendChild(y)}else n.setAttribute("data-display","0");_.appendChild(s)}},close($){if(!K.dataLoaded||!K.creditsLoaded||!K.similarLoaded||!K.seasonLoaded)o("The modal is closed");var Q;if(K.mediaType==="tv")Q=$.modal.children[0];else Q=$.modal.children[1];var W=Q.children[1].firstElementChild?.firstElementChild,z=Q.children[3];W?.setAttribute("data-display","0"),W?.setAttribute("src",""),W?.setAttribute("alt","");var V=z.children.length;if(z.children[0].replaceChildren(),z.children[1].replaceChildren(),z.children[2].replaceChildren(),z.children[3].replaceChildren(),z.children[4].replaceChildren(),z.children[5].replaceChildren(),z.lastElementChild.replaceChildren(),K.mediaType==="tv"){var U=z.children[6];U.replaceChildren(),U.setAttribute("data-display","0")}var X=z.children[V-2];X.setAttribute("data-display","0"),X.lastElementChild.replaceChildren(),$.main.style.removeProperty("transform"),$.main.toggleAttribute("data-fixed"),$.modal.setAttribute("data-display","0"),document.firstElementChild.scrollTop=K.topScroll,K.isOpen=!1,K.seasonNumber=-1,K.id="",K.dataLoaded=!1,K.creditsLoaded=!1,K.similarLoaded=!1,K.seasonLoaded=!1},open($,Q,W,z){K.topScroll=document.firstElementChild.scrollTop,document.firstElementChild.scrollTop=0,K.isOpen=!0,K.mediaType=$,K.id=Q,W.modal.setAttribute("data-display","1"),W.modal.setAttribute("data-select",$),W.main.style.setProperty("transform",`translateY(-${K.topScroll}px)`),W.main.toggleAttribute("data-fixed"),K.getData($,Q,W,z)},onchange($,Q){var W=$.getAttribute("data-type");if(W===J.MODAL_SEASON_N){var z=Number($.value);if(z===NaN)return;if(z!==K.seasonNumber)K.seasonNumber=z,K.getSeason(K.id,z,Q.modal.children[0],Q.templateModal.content)}},onclick($,Q){var W=$.getAttribute("data-type");if(W===J.MODAL||W===J.MODAL_CLOSE)K.close(Q),x.pushstate(x.href);else if(W===J.MODAL_C_MORE)$.parentElement.setAttribute("data-more","1");else if(W===J.ITEM){var z=$?.getAttribute("data-id"),V=$?.getAttribute("data-media");K.close(Q),K.open(V,z,Q,!0)}}},d={TYPE:J,API:h,Theme:k,Hero:r,Nav:R,Route:x,Item:i,Modal:K,Utils:p};export{d as default};
