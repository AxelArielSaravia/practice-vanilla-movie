import h from"../general.js";async function z(c,w,u){var F;try{F=await c}catch{f.ended=!0,DocumentFragment.prototype.replaceChildren.apply(u.templateSkeleton.content,A);return}if(F?.results===void 0||F.results.length===0){f.ended=!0,DocumentFragment.prototype.replaceChildren.apply(u.templateSkeleton.content,A);return}var Q;for(var v of F.results)Q=h.Item.createDOMItem(v,w,u.templateItem?.content?.firstElementChild),f.fragment.appendChild(Q);DocumentFragment.prototype.replaceChildren.apply(u.templateSkeleton.content,A),u.view.appendChild(f.fragment),u.buttonMore.setAttribute("data-display","1")}var f={fragment:document.createDocumentFragment(),maxPages:0,page:1,ended:!1},A=Array(6);window.addEventListener("DOMContentLoaded",function(){var c={templateSkeleton:document.getElementById("template_skeleton"),templateItem:document.getElementById("template_item"),templateModal:document.getElementById("template_modal"),headerPNav:document.getElementById("header_p_nav"),headerButtonTheme:document.getElementById("header_button-theme"),main:document.getElementById("main"),view:document.getElementById("view"),buttonMore:document.getElementById("button-more"),modal:document.getElementById("modal")};if(c.templateSkeleton===null)throw Error("DOM.templateSkeleton is null");if(c.templateItem===null)throw Error("DOM.templateItem is null");if(c.templateModal===null)throw Error("DOM.templateModal is null");if(c.headerPNav===null)throw Error("DOM.headerPNav is null");if(c.headerButtonTheme===null)throw Error("DOM.headerButtonTheme is null");if(c.main===null)throw Error("DOM.main is null");if(c.view===null)throw Error("DOM.view is null");if(c.buttonMore===null)throw Error("DOM.buttonMore is null");if(c.modal===null)throw Error("DOM.modal is null");h.Route.url.href=window.location.href;var w=h.Route.url,u=w.searchParams.get(h.Route.Q_MEDIA_TYPE);if(u==="tv")c.main.firstElementChild.textContent+=" Tv Series";else if(u==="movie")c.main.firstElementChild.textContent+=" Movies";else throw Error("Bad Route");A[0]=c.view.children[0],A[1]=c.view.children[1],A[2]=c.view.children[2],A[3]=c.view.children[3],A[4]=c.view.children[4],A[5]=c.view.children[5],h.Theme.init(),h.Route.href=`${h.Route.href}?${h.Route.Q_MEDIA_TYPE}=${u}`,h.Route.init(c),window.addEventListener("popstate",function(){h.Route.onpopstate(c)}),c.headerButtonTheme.setAttribute("data-type",h.Theme.current),c.headerButtonTheme.addEventListener("click",h.Theme.onclick),c.headerPNav.firstElementChild.addEventListener("click",h.Nav.buttonNavOnclick),c.headerPNav.lastElementChild.addEventListener("focusout",h.Nav.navOnfocusout),c.buttonMore.addEventListener("click",function(){if(c.buttonMore?.setAttribute("data-display","0"),f.ended)return;c.view.appendChild(c.templateSkeleton.content),z(h.API.getPopular(u,String(f.page)),u,c),f.page+=1}),c.view.addEventListener("click",function(v){var E=v.target,b=E.getAttribute("data-type");if(b===h.TYPE.ITEM){v.preventDefault();var x=E.getAttribute("data-id");if(x!==null)h.Modal.open(u,x,c,!0)}}),c.modal.addEventListener("click",function(v){h.Modal.onclick(v.target,c)}),c.modal.addEventListener("change",function(v){h.Modal.onchange(v.target,c)});var F=h.API.getPopular(u,String(f.page));f.page+=1;var Q=h.API.getPopular(u,String(f.page));f.page+=1,F.then(function(v){if(v?.results===void 0||v.results.length===0){f.ended=!0,c.main.children[1].setAttribute("data-display","1");return}var E;for(var b of v.results)E=h.Item.createDOMItem(b,u,c.templateItem?.content?.firstElementChild),f.fragment.appendChild(E);DocumentFragment.prototype.replaceChildren.apply(c.templateSkeleton.content,A),c.view.appendChild(f.fragment),F=null}),Q.then(function(v){if(v?.results===void 0||v.results.length===0){f.ended=!0;return}var E;for(var b of v.results)E=h.Item.createDOMItem(b,u,c.templateItem?.content?.firstElementChild),f.fragment.appendChild(E);c.view.appendChild(f.fragment),c.buttonMore?.setAttribute("data-display","1"),Q=null})});
