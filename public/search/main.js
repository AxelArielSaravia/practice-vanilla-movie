import t from"../general.js";async function s(e,i){var l;try{l=await e}catch{a.ended=!0,DocumentFragment.prototype.replaceChildren.apply(i.templateSkeleton.content,o);return}if(l?.results===void 0||l.results.length===0){a.ended=!0,DocumentFragment.prototype.replaceChildren.apply(i.templateSkeleton.content,o);return}var d="",c;for(var n of l.results)if(d=n.media_type,d==="movie"||d==="tv")c=t.Item.createDOMItem(n,d,i.templateItem?.content?.firstElementChild),a.fragment.appendChild(c);DocumentFragment.prototype.replaceChildren.apply(i.templateSkeleton.content,o),i.view.appendChild(a.fragment),i.buttonMore.setAttribute("data-display","1")}var a={fragment:document.createDocumentFragment(),maxPages:0,page:3,ended:!1},o=Array(6);window.addEventListener("DOMContentLoaded",function(){var e={templateSkeleton:document.getElementById("template_skeleton"),templateItem:document.getElementById("template_item"),templateModal:document.getElementById("template_modal"),headerPNav:document.getElementById("header_p_nav"),headerSearch:document.getElementById("header_search"),headerButtonTheme:document.getElementById("header_button-theme"),main:document.getElementById("main"),view:document.getElementById("view"),buttonMore:document.getElementById("button-more"),modal:document.getElementById("modal")};if(e.templateSkeleton===null)throw Error("DOM.templateSkeleton is null");if(e.templateItem===null)throw Error("DOM.templateItem is null");if(e.templateModal===null)throw Error("DOM.templateModal is null");if(e.headerPNav===null)throw Error("DOM.headerPNav is null");if(e.headerSearch===null)throw Error("DOM.headerSearch is null");if(e.headerButtonTheme===null)throw Error("DOM.headerButtonTheme is null");if(e.main===null)throw Error("DOM.main is null");if(e.view===null)throw Error("DOM.view is null");if(e.buttonMore===null)throw Error("DOM.buttonMore is null");if(e.modal===null)throw Error("DOM.modal is null");t.Route.url.href=window.location.href;var i=t.Route.url,l=i.searchParams.get(t.Route.Q_SEARCH);if(l!==null)e.main.firstElementChild.textContent+=` ${l}`;else{window.open("./404.html","_self","noopener,noreferrer");return}o[0]=e.view.children[0],o[1]=e.view.children[1],o[2]=e.view.children[2],o[3]=e.view.children[3],o[4]=e.view.children[4],o[5]=e.view.children[5],t.Theme.init(),t.Route.href=`${t.Route.href}?${t.Route.Q_SEARCH}=${l}`,t.Route.hrefq=`${t.Route.href}&`,t.Route.init(e),window.addEventListener("popstate",function(){t.Route.onpopstate(e)}),e.headerButtonTheme.setAttribute("data-type",t.Theme.current),e.headerButtonTheme.addEventListener("click",t.Theme.onclick),e.headerPNav.firstElementChild.addEventListener("click",t.Nav.buttonNavOnclick),e.headerPNav.lastElementChild.addEventListener("focusout",t.Nav.navOnfocusout),e.headerSearch.children[1].addEventListener("click",function(n){e.headerSearch.reset()}),e.buttonMore.addEventListener("click",function(){if(e.buttonMore?.setAttribute("data-display","0"),a.ended)return;e.view.appendChild(e.templateSkeleton.content),s(t.API.getSearch(l,String(a.page)),e),a.page+=1}),e.view.addEventListener("click",function(n){var r=n.target,u=r.getAttribute("data-type");if(u===t.TYPE.ITEM){n.preventDefault();var m=r.getAttribute("data-media"),h=r.getAttribute("data-id");if(h!==null)t.Modal.open(m,h,e,!0)}}),e.modal.addEventListener("click",function(n){t.Modal.onclick(n.target,e)}),e.modal.addEventListener("change",function(n){t.Modal.onchange(n.target,e)});var d=t.API.getSearch(l,"1"),c=t.API.getSearch(l,"2");d.then(function(n){if(n?.results===void 0||n.results.length===0)a.ended=!0,e.main.children[1].setAttribute("data-display","1");else{var r="",u;for(var m of n.results)if(r=m.media_type,r==="movie"||r==="tv")u=t.Item.createDOMItem(m,r,e.templateItem?.content?.firstElementChild),a.fragment.appendChild(u)}DocumentFragment.prototype.replaceChildren.apply(e.templateSkeleton.content,o),e.view.appendChild(a.fragment),d=null}),c.then(function(n){if(n?.results===void 0||n.results.length===0){a.ended=!0;return}var r="",u;for(var m of n.results)if(r=m.media_type,r==="movie"||r==="tv")u=t.Item.createDOMItem(m,r,e.templateItem?.content?.firstElementChild),a.fragment.appendChild(u);e.view.appendChild(a.fragment),e.buttonMore?.setAttribute("data-display","1"),c=null})});
