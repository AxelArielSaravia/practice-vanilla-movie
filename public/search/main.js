import A from"../general.js";async function F(f,v){var N;try{N=await f}catch{E.ended=!0,DocumentFragment.prototype.replaceChildren.apply(v.templateSkeleton.content,_);return}if(N?.results===void 0||N.results.length===0){E.ended=!0,DocumentFragment.prototype.replaceChildren.apply(v.templateSkeleton.content,_);return}var w="",B;for(var b of N.results)if(w=b.media_type,w==="movie"||w==="tv")B=A.Item.createDOMItem(b,w,v.templateItem?.content?.firstElementChild),E.fragment.appendChild(B);DocumentFragment.prototype.replaceChildren.apply(v.templateSkeleton.content,_),v.view.appendChild(E.fragment),v.buttonMore.setAttribute("data-display","1")}var E={fragment:document.createDocumentFragment(),maxPages:0,page:3,ended:!1},_=Array(6);window.addEventListener("DOMContentLoaded",function(){var f={templateSkeleton:document.getElementById("template_skeleton"),templateItem:document.getElementById("template_item"),templateModal:document.getElementById("template_modal"),headerPNav:document.getElementById("header_p_nav"),headerSearch:document.getElementById("header_search"),headerButtonTheme:document.getElementById("header_button-theme"),main:document.getElementById("main"),view:document.getElementById("view"),buttonMore:document.getElementById("button-more"),modal:document.getElementById("modal")};if(f.templateSkeleton===null)throw Error("DOM.templateSkeleton is null");if(f.templateItem===null)throw Error("DOM.templateItem is null");if(f.templateModal===null)throw Error("DOM.templateModal is null");if(f.headerPNav===null)throw Error("DOM.headerPNav is null");if(f.headerSearch===null)throw Error("DOM.headerSearch is null");if(f.headerButtonTheme===null)throw Error("DOM.headerButtonTheme is null");if(f.main===null)throw Error("DOM.main is null");if(f.view===null)throw Error("DOM.view is null");if(f.buttonMore===null)throw Error("DOM.buttonMore is null");if(f.modal===null)throw Error("DOM.modal is null");A.Route.url.href=window.location.href;var v=A.Route.url,N=v.searchParams.get(A.Route.Q_SEARCH);if(N!==null)f.main.firstElementChild.textContent+=` ${N}`;else throw Error("Bad Route");_[0]=f.view.children[0],_[1]=f.view.children[1],_[2]=f.view.children[2],_[3]=f.view.children[3],_[4]=f.view.children[4],_[5]=f.view.children[5],A.Theme.init(),A.Route.href=`${A.Route.href}?${A.Route.Q_SEARCH}=${N}`,A.Route.hrefq=`${A.Route.href}&`,A.Route.init(f),window.addEventListener("popstate",function(){A.Route.onpopstate(f)}),f.headerButtonTheme.setAttribute("data-type",A.Theme.current),f.headerButtonTheme.addEventListener("click",A.Theme.onclick),f.headerPNav.firstElementChild.addEventListener("click",A.Nav.buttonNavOnclick),f.headerPNav.lastElementChild.addEventListener("focusout",A.Nav.navOnfocusout),f.headerSearch.children[1].addEventListener("click",function(b){f.headerSearch.reset()}),f.buttonMore.addEventListener("click",function(){if(f.buttonMore?.setAttribute("data-display","0"),E.ended)return;f.view.appendChild(f.templateSkeleton.content),F(A.API.getSearch(N,String(E.page)),f),E.page+=1}),f.view.addEventListener("click",function(b){var u=b.target,x=u.getAttribute("data-type");if(x===A.TYPE.ITEM){b.preventDefault();var z=u.getAttribute("data-media"),C=u.getAttribute("data-id");if(C!==null)A.Modal.open(z,C,f,!0)}}),f.modal.addEventListener("click",function(b){A.Modal.onclick(b.target,f)}),f.modal.addEventListener("change",function(b){A.Modal.onchange(b.target,f)});var w=A.API.getSearch(N,"1"),B=A.API.getSearch(N,"2");w.then(function(b){if(b?.results===void 0||b.results.length===0)E.ended=!0,f.main.children[1].setAttribute("data-display","1");else{var u="",x;for(var z of b.results)if(u=z.media_type,u==="movie"||u==="tv")x=A.Item.createDOMItem(z,u,f.templateItem?.content?.firstElementChild),E.fragment.appendChild(x)}DocumentFragment.prototype.replaceChildren.apply(f.templateSkeleton.content,_),f.view.appendChild(E.fragment),w=null}),B.then(function(b){if(b?.results===void 0||b.results.length===0){E.ended=!0;return}var u="",x;for(var z of b.results)if(u=z.media_type,u==="movie"||u==="tv")x=A.Item.createDOMItem(z,u,f.templateItem?.content?.firstElementChild),E.fragment.appendChild(x);f.view.appendChild(E.fragment),f.buttonMore?.setAttribute("data-display","1"),B=null})});
