var L=function(_){if(_.ok)return _.json()};var v={getTrending(_="1"){return fetch(`${window.location.origin}/api/trending?page=${_}`).then(L)},getPopular(_,x="1"){return fetch(`${window.location.origin}/api/popular?type=${_}&page=${x}`).then(L)},getDiscover(_,x,q="1"){var $=`${window.location.origin}/api/discover?type=${_}&page=${q}`;if(x!==void 0)$=`${$}&genre=${x}`;return fetch($).then(L)},getImages(_,x){return fetch(`${window.location.origin}/api/images?type=${x}&id=${_}`).then(L)},getGenres(_){return fetch(`${window.location.origin}/api/genres?type=${_}`).then(L)},getTopRated(_,x="1"){return fetch(`${window.location.origin}/api/toprated?type=${_}&page=${x}`).then(L)},get(_,x){return fetch(`${window.location.origin}/api/${_}?id=${x}`).then(L)},getCredits(_,x){return fetch(`${window.location.origin}/api/credits?type=${_}&id=${x}`).then(L)}},R=v;var h=function(_){return Math.floor(Math.random()*_)},P=function(_){var x=_.length;for(var q=0;q<x-1;q+=1){var $=q+Math.floor(Math.random()*(x-q)),K=_[q];_[q]=_[$],_[$]=K}};async function C(_,x,q,$,K,W){var J=await _;if(console.info(x,J),J?.results===void 0||J.results.length===0)throw Error("API.getTopRated does not have data");var z=H.createDOMCollection(x,J.results,q,W.templateCollection.content),Q=W.view.children[K+$];Q.insertAdjacentElement("beforebegin",z),Q.remove()}var N={NAV_LINK:"0",COLL_TITLE:"4",COLL_BUTTON:"5",COLL_ITEM:"6",MODAL:"8",MODAL_CLOSE:"9",MODAL_GENRE:"10",MODAL_COMPANY:"11"},U={MAX:15,STEPS:5,len:0,count:7,itv:0,tvGenres:null,imov:0,movieGenres:null},j={current:"dark",DARK:"dark",LIGHT:"light",init(){var _=localStorage.getItem("theme");if(_==="dark"||_==="light")j.current=_;else{if(window.matchMedia!==void 0&&window.matchMedia("(prefers-color-scheme: dark)").matches)j.current=j.DARK;else j.current=j.LIGHT;localStorage.setItem("theme",j.current)}document.firstElementChild?.setAttribute("class",j.current)},change(_){localStorage.setItem("theme",_),document.firstElementChild?.setAttribute("class",j.current)},onclick(_){var x=_.currentTarget;if(x===null)return;if(j.current===j.DARK)j.current=j.LIGHT;else j.current=j.DARK;x.setAttribute("data-type",j.current),j.change(j.current)}},F={ATTR_SHOW:"data-mbshow",ATTR_SELECTED:"data-selected",ATTR_LINK_TYPE:"data-linkt",HIDDEN:"0",SHOW:"1",buttonNavOnclick(_){console.info(_);var x=_.currentTarget,q=x.nextElementSibling;if(q.getAttribute(F.ATTR_SHOW)===F.HIDDEN)q.setAttribute(F.ATTR_SHOW,F.SHOW),q.firstElementChild.firstElementChild.focus();else q.setAttribute(F.ATTR_SHOW,F.HIDDEN)},navOnfocusout(_){var x=_.relatedTarget;if(x===null||x.getAttribute("data-type")!==N.NAV_LINK){var q=_.currentTarget;q.setAttribute(F.ATTR_SHOW,F.HIDDEN)}},navOnclick(_){var x=_.target;if(x.getAttribute("data-type")===N.NAV_LINK){var q=x.getAttribute(F.ATTR_LINK_TYPE),$=_.currentTarget,K=$.previousElementSibling;K.replaceChildren(),K.insertAdjacentText("beforeend",x.textContent),$.setAttribute(F.ATTR_SHOW,F.HIDDEN),$.setAttribute(F.ATTR_SELECTED,q),_.preventDefault()}}},S={select(_){return _[h(_.length)]},selectHero(_){if(_){if(!_.results||_.results.length===0)throw Error("trending.results does not have data");return S.select(_.results)}},async getHeroLogo(_){if(_===void 0)return;var{id:x,media_type:q}=_,$=await R.getImages(x,q);if($.logos.length>0)return $.logos[0].file_path;else return},initDOMImgLogo(_,x){var q=x.lastElementChild.firstElementChild;if(_!==void 0)q.firstElementChild.setAttribute("data-opacity","0"),q.lastElementChild.setAttribute("data-display","1"),q.lastElementChild.setAttribute("src",`https://image.tmdb.org/t/p/w300${_}`)},initDOM(_,x){var q=x.firstElementChild.firstElementChild,$=x.lastElementChild,K=$.firstElementChild.firstElementChild,W=$.lastElementChild;if(q.setAttribute("data-display","1"),q.setAttribute("src",`https://image.tmdb.org/t/p/w1280${_.backdrop_path}`),_.media_type==="tv")K.insertAdjacentText("beforeend",_.name);else K.insertAdjacentText("beforeend",_.title);$.setAttribute("data-media",_.media_type),$.setAttribute("data-id",_.id),W.insertAdjacentText("beforeend",_.overview)}},H={TYPE_SBUTTON:"data-sbuttont",topScroll:0,DOMCollButtonOnclick(_){var x=_.parentElement.lastElementChild;const q=_.parentElement.children[1],$=_.parentElement.children[2];var K=_.getAttribute(H.TYPE_SBUTTON),W=x.clientWidth-x.clientWidth*6/100;if(x.scrollLeft-W<=0)q.setAttribute("data-display","0");else q.setAttribute("data-display","1");if(K==="0"){if(x.scrollBy(-W,0),x.scrollLeft-W<=0)q.setAttribute("data-display","0");$.setAttribute("data-display","1")}else{if(x.scrollBy(W,0),x.scrollLeft+W>=x.scrollWidth-x.clientWidth)$.setAttribute("data-display","0");q.setAttribute("data-display","1")}},async setItemImage(_,x,q){var $=await _,K=x.firstElementChild;if($===void 0||$.backdrops===void 0||$.backdrops.length===0){if(q!==null&&q.length>0)K.setAttribute("src",`https://image.tmdb.org/t/p/w400${q}`),K.setAttribute("data-display","1"),x.lastElementChild?.setAttribute("data-opacity","0")}else{var W=$.backdrops[0];K.setAttribute("src",`https://image.tmdb.org/t/p/w400${W.file_path}`),K.setAttribute("data-display","1"),x.lastElementChild?.setAttribute("data-opacity","0")}},createDOMCollection(_,x,q,$){var K=$.children[1].cloneNode(!0),W=K.children[0];W.insertAdjacentText("beforeend",_);for(var J of x){const z=$.children[2].cloneNode(!0);z.setAttribute("data-id",J.id);let Q,X;if(q!==void 0)X=q;else X=J.media_type;if(X==="movie")Q=J.title;else Q=J.name;z.setAttribute("title",Q),z.setAttribute("data-media",X),z.lastElementChild.insertAdjacentText("beforeend",Q),z.firstElementChild.setAttribute("alt",Q),H.setItemImage(R.getImages(J.id,X),z,J.backdrop_path),K.lastElementChild.appendChild(z)}return K}},V={fragment:document.createDocumentFragment(),buffer:[],async getCredit(_,x,q,$){var K=await R.getCredits(_,x);if(K===void 0)return;var W=q.children[3].lastElementChild,J=$.children[0],z=$.children[1],Q=$.children[2],X=Q.cloneNode(!0);X.firstElementChild.textContent="Cast:";for(var f=0;f<K.cast.length;f+=1){var Y=K.cast[f],E=J.cloneNode(!1);E.setAttribute("data-id",Y.id),E.setAttribute("data-type","11"),E.textContent=Y.name,X.appendChild(E)}W.appendChild(X);var b=V.buffer;b.length=0},async getData(_,x,q){var $=await R.get(_,x);if($===void 0)return;var K,W=q.modal,J=q.templateModal.content.children[2],z=q.templateModal.content.children[0];if(_==="tv"){K=W.children[0];var Q=K.children[1].firstElementChild.firstElementChild,X=K.children[3].children[0],f=K.children[3].children[1],Y=K.children[3].children[2],E=K.children[3].lastElementChild,z=q.templateModal.content.children[0],b=document.createElement("span");if(X.textContent=$.name,Y.textContent=$?.overview,$?.backdrop_path!=null)Q.setAttribute("src",`https://image.tmdb.org/t/p/w780${$.backdrop_path}`),Q.setAttribute("alt",$.name),Q.setAttribute("data-display","1");if($.genres.length>0){for(var A of $.genres){var k=z.cloneNode(!0);k.textContent=A.name,k.setAttribute("data-id",A.id),k.setAttribute("data-type","10"),V.fragment.appendChild(k)}f.appendChild(V.fragment)}if($.spoken_languages.length>0){var B=J.cloneNode(!0),b=document.createElement("span");B.firstElementChild.textContent="Languages:";for(let c=0;c<$.spoken_languages.length;c+=1){var u=$.spoken_languages[c],Z=b.cloneNode(!0);if(Z.setAttribute("title",u.english_name),u.name.length>0)Z.textContent=u.name;else Z.textContent=u.english_name;B.appendChild(Z)}E?.appendChild(B)}if($.production_companies.length>0){var w=J.cloneNode(!0);w.firstElementChild.textContent="Companies:";for(var G of $.production_companies){var Z=z.cloneNode(!0);z.setAttribute("data-type",N.MODAL_COMPANY),z.setAttribute("data-id",G.id),Z.textContent=G.name,w.appendChild(Z)}E?.appendChild(w)}if($.production_countries.length>0){var w=J.cloneNode(!0);w.firstElementChild.textContent="Countries:";for(var y of $.production_countries){var Z=b.cloneNode(!0);Z.textContent=y.name,w.appendChild(Z)}E?.appendChild(w)}}else{K=W.children[1];var Q=K.children[1].firstElementChild.firstElementChild,X=K.children[3].children[0],f=K.children[3].children[1],Y=K.children[3].children[2],E=K.children[3].lastElementChild,z=q.templateModal.content.children[0],b=document.createElement("span");if(X.textContent=$.title,Y.textContent=$?.overview,$?.backdrop_path!=null)Q.setAttribute("src",`https://image.tmdb.org/t/p/w780${$.backdrop_path}`),Q.setAttribute("alt",$.title),Q.setAttribute("data-display","1");if($.genres.length>0){for(var A of $.genres){var k=z.cloneNode(!0);k.textContent=A.name,k.setAttribute("data-id",A.id),k.setAttribute("data-type","10"),V.fragment.appendChild(k)}f.appendChild(V.fragment)}if($.spoken_languages.length>0){var B=J.cloneNode(!0);B.firstElementChild.textContent="Languages:";for(var u of $.spoken_languages){var Z=b.cloneNode(!0);if(Z.setAttribute("title",u.english_name),u.name.length>0)Z.textContent=u.name;else Z.textContent=u.english_name;B.appendChild(Z)}E?.appendChild(B)}if($.production_companies.length>0){var w=J.cloneNode(!0);w.firstElementChild.textContent="Companies:";for(var G of $.production_companies){var Z=z.cloneNode(!0);z.setAttribute("data-type",N.MODAL_COMPANY),z.setAttribute("data-id",G.id),Z.textContent=G.name,w.appendChild(Z)}E?.appendChild(w)}if($.production_countries.length>0){var w=J.cloneNode(!0);w.firstElementChild.textContent="Countries:";for(var y of $.production_countries){var Z=b.cloneNode(!0);Z.textContent=y.name,w.appendChild(Z)}E?.appendChild(w)}V.getCredit(_,x,K,q.templateModal.content)}console.info($)},close(_){var x=_.modal.getAttribute("data-select"),q;if(x==="tv")q=_.modal.children[0];else q=_.modal.children[1];var $=q.children[1].firstElementChild?.firstElementChild,K=q.children[3].children[0],W=q.children[3].children[1],J=q.children[3].children[2];q.children[3].lastElementChild.replaceChildren(),$.setAttribute("data-display","0"),K.textContent="",J.textContent="",W.replaceChildren(),_.main.style.removeProperty("transform"),_.main.style.setProperty("position","relative"),document.firstElementChild.scrollTop=H.topScroll,_.modal.setAttribute("data-display","0")},open(_,x,q){H.topScroll=document.firstElementChild.scrollTop,document.firstElementChild.scrollTop=0,q.modal.setAttribute("data-display","1"),q.modal.setAttribute("data-select",_),q.main.style.setProperty("transform",`translateY(-${H.topScroll}px)`),q.main.style.setProperty("position","fixed"),V.getData(_,x,q)}};window.addEventListener("DOMContentLoaded",function(){var _={templateCollection:document.getElementById("template_collection"),templateIcons:document.getElementById("template_icons"),templateModal:document.getElementById("template_modal"),headerButtonNav:document.getElementById("header_button-nav"),headerNav:document.getElementById("header_nav"),headerButtonSearch:document.getElementById("header_button-search"),headerButtonTheme:document.getElementById("header_button-theme"),main:document.getElementById("main"),hero:document.getElementById("hero"),view:document.getElementById("view"),buttonMore:document.getElementById("button-more"),modal:document.getElementById("modal")};if(_.templateCollection===null)throw Error("DOM.templateCollection is null");if(_.templateIcons===null)throw Error("DOM.templateIcons is null");if(_.templateModal===null)throw Error("DOM.templateModal is null");if(_.headerButtonNav===null)throw Error("DOM.headerButtonNav is null");if(_.headerNav===null)throw Error("DOM.headerNav is null");if(_.headerButtonSearch===null)throw Error("DOM.headerButtonSearch is null");if(_.headerButtonTheme===null)throw Error("DOM.headerButtonTheme is null");if(_.main===null)throw Error("DOM.main is null");if(_.hero===null)throw Error("DOM.hero is null");if(_.view===null)throw Error("DOM.view is null");if(_.buttonMore===null)throw Error("DOM.buttonMore is null");if(_.modal===null)throw Error("DOM.modal is null");j.init(),_.headerButtonTheme.setAttribute("data-type",j.current),_.headerButtonTheme.addEventListener("click",j.onclick),_.headerButtonNav.addEventListener("click",F.buttonNavOnclick),_.headerNav.addEventListener("focusout",F.navOnfocusout),_.headerNav.addEventListener("click",F.navOnclick),_.view.addEventListener("click",function(W){var J=W.target,z=J.getAttribute("data-type");if(z===N.COLL_BUTTON)H.DOMCollButtonOnclick(J);else if(z===N.COLL_ITEM){var Q=J?.getAttribute("data-media"),X=J?.getAttribute("data-id");V.open(Q,X,_)}}),_.hero.lastElementChild.addEventListener("click",function(W){var J=W.target,z=J?.getAttribute("data-id");if(z!==void 0){var Q=J?.getAttribute("data-media");V.open(Q,z,_)}}),_.modal.addEventListener("click",function(W){var J=W.target,z=J.getAttribute("data-type");if(z===N.MODAL||z===N.MODAL_CLOSE)V.close(_)});var x=R.getTrending("1");x.then(function(W){console.info("trending: ",W)});var q=x.then(S.selectHero);q.then(function(W){console.info("hero: ",W)}),q.then(S.getHeroLogo).then(function(W){S.initDOMImgLogo(W,_.hero)}),q.then(function(W){if(W!==void 0)S.initDOM(W,_.hero)}),x.then(function(W){if(W?.results===void 0||W.results.length===0)throw Error("API.getTrending does not have data");var J=H.createDOMCollection("Week Trendings",W.results,void 0,_.templateCollection.content),z=_.view.children[0];z.insertAdjacentElement("beforebegin",J),z.remove()}),R.getPopular("movie","1").then(function(W){if(console.info("getPopular movie",W),W?.results===void 0||W.results.length===0)throw Error("API.getDiscover does not have data");var J=H.createDOMCollection("Popular Movies",W.results,"movie",_.templateCollection.content),z=_.view.children[1];z.insertAdjacentElement("beforebegin",J),z.remove()}),R.getPopular("tv","1").then(function(W){if(console.info("getPopular tv",W),W?.results===void 0||W.results.length===0)throw Error("API.getDiscover does not have data");var J=H.createDOMCollection("Popular Tv series",W.results,"tv",_.templateCollection.content),z=_.view.children[2];z.insertAdjacentElement("beforebegin",J),z.remove()}),R.getTopRated("movie","1").then(function(W){if(console.info("getTopRate movie",W),W?.results===void 0||W.results.length===0)throw Error("API.getTopRated does not have data");var J=H.createDOMCollection("Top rated movie",W.results,"movie",_.templateCollection.content),z=_.view.children[3];z.insertAdjacentElement("beforebegin",J),z.remove()}),R.getTopRated("tv","1").then(function(W){if(console.info("getTopRate tv",W),W?.results===void 0||W.results.length===0)throw Error("API.getTopRated does not have data");var J=H.createDOMCollection("Top rated tv serie",W.results,"tv",_.templateCollection.content),z=_.view.children[4];z.insertAdjacentElement("beforebegin",J),z.remove()});var $=R.getGenres("movie"),K=R.getGenres("tv");Promise.all([$,K]).then(function(W){if(console.info("movie genres",W[0]),console.info("tv genres",W[1]),W[0]===void 0||W[0].genres===void 0||W[0].genres.length===0)throw Error("API.getGenre does not have data");if(W[1]===void 0||W[1].genres===void 0||W[1].genres.length===0)throw Error("API.getGenre does not have data");var J=W[0].genres,z=W[1].genres;if(U.tvGenres=z,U.movieGenres=J,J.length+z.length<U.MAX)U.len=J.length+z.length;else U.len=U.MAX;if(console.info(U),_.buttonMore?.setAttribute("data-display","1"),J.length>1)P(J);if(z.length>1)P(z);var Q,X,f,Y,E=0,b=0;for(let A=0;A<2;A+=1){if(Math.random()<0.5)X=J[E].id,f=J[E].name,Q="movie",Y=`${f} Movies`,E+=1,U.imov+=1;else X=z[b].id,f=z[b].name,Q="tv",Y=`${f} Tv series`,b+=1,U.itv+=1;C(R.getDiscover(Q,X,"1"),Y,Q,A,5,_)}}),_.buttonMore.addEventListener("click",function(W){var J,z,Q,X,f=U.movieGenres,Y=U.tvGenres,E=U.itv,b=U.imov,A=0;_.buttonMore?.setAttribute("data-display","0");var k=0,B=!1;if(U.count+U.STEPS<U.len)k=U.count+U.STEPS;else k=U.len,B=!0;for(var u=U.count;u<k;u+=1){var Z=_.templateCollection.content.children[0].cloneNode(!0);_.view?.appendChild(Z)}for(var u=U.count;u<k;u+=1){if(E<Y.length&&b<f.length){if(Math.random()<0.5)A=1}else if(tv<Y.length)A=1;if(A===0)z=f[b].id,Q=f[b].name,J="movie",X=`${Q} Movies`,b+=1,U.imov+=1;else z=Y[E].id,Q=Y[E].name,J="tv",X=`${Q} Tv series`,E+=1,U.itv+=1;U.count+=1,C(R.getDiscover(J,z,"1"),X,J,u,_.view.children.length-k,_)}if(!B)_.buttonMore?.setAttribute("data-display","1")})});
