var N=function(_){if(_.ok)return _.json()};var T={getTrending(_="1"){return fetch(`${window.location.origin}/api/trending?page=${_}`).then(N)},getPopular(_,x="1"){return fetch(`${window.location.origin}/api/popular?type=${_}&page=${x}`).then(N)},getDiscover(_,x,q="1"){var $=`${window.location.origin}/api/discover?type=${_}&page=${q}`;if(x!==void 0)$=`${$}&genre=${x}`;return fetch($).then(N)},getImages(_,x){return fetch(`${window.location.origin}/api/images?type=${x}&id=${_}`).then(N)},getGenres(_){return fetch(`${window.location.origin}/api/genres?type=${_}`).then(N)},getTopRated(_,x="1"){return fetch(`${window.location.origin}/api/toprated?type=${_}&page=${x}`).then(N)},get(_,x,q){return fetch(`${window.location.origin}/api/${_}?id=${x}`,q).then(N)},getCredits(_,x,q){return fetch(`${window.location.origin}/api/credits?type=${_}&id=${x}`,q).then(N)}},f=T;var c=function(_){return Math.floor(Math.random()*_)},P=function(_){var x=_.length;for(var q=0;q<x-1;q+=1){var $=q+Math.floor(Math.random()*(x-q)),W=_[q];_[q]=_[$],_[$]=W}};var s=function(_){h.abort(_),h=new AbortController,v.signal=h.signal};async function g(_,x,q,$,W,z){var K=await _;if(console.info(x,K),K?.results===void 0||K.results.length===0)throw Error("API.getTopRated does not have data");var Q=G.createDOMCollection(x,K.results,q,z.templateCollection.content),Z=z.view.children[W+$];Z.insertAdjacentElement("beforebegin",Q),Z.remove()}var w={NAV_LINK:"0",COLL_TITLE:"4",COLL_BUTTON:"5",COLL_ITEM:"6",MODAL:"8",MODAL_CLOSE:"9",MODAL_GENRE:"10",MODAL_LANG:"11",MODAL_COMPANY:"12",MODAL_COUNTRY:"13",MODAL_CAST:"14"},V={MAX:15,STEPS:5,len:0,count:7,itv:0,tvGenres:null,imov:0,movieGenres:null},H={current:"dark",DARK:"dark",LIGHT:"light",init(){var _=localStorage.getItem("theme");if(_==="dark"||_==="light")H.current=_;else{if(window.matchMedia!==void 0&&window.matchMedia("(prefers-color-scheme: dark)").matches)H.current=H.DARK;else H.current=H.LIGHT;localStorage.setItem("theme",H.current)}document.firstElementChild?.setAttribute("class",H.current)},change(_){localStorage.setItem("theme",_),document.firstElementChild?.setAttribute("class",H.current)},onclick(_){var x=_.currentTarget;if(x===null)return;if(H.current===H.DARK)H.current=H.LIGHT;else H.current=H.DARK;x.setAttribute("data-type",H.current),H.change(H.current)}},A={ATTR_SHOW:"data-mbshow",ATTR_SELECTED:"data-selected",ATTR_LINK_TYPE:"data-linkt",HIDDEN:"0",SHOW:"1",buttonNavOnclick(_){console.info(_);var x=_.currentTarget,q=x.nextElementSibling;if(q.getAttribute(A.ATTR_SHOW)===A.HIDDEN)q.setAttribute(A.ATTR_SHOW,A.SHOW),q.firstElementChild.firstElementChild.focus();else q.setAttribute(A.ATTR_SHOW,A.HIDDEN)},navOnfocusout(_){var x=_.relatedTarget;if(x===null||x.getAttribute("data-type")!==w.NAV_LINK){var q=_.currentTarget;q.setAttribute(A.ATTR_SHOW,A.HIDDEN)}},navOnclick(_){var x=_.target;if(x.getAttribute("data-type")===w.NAV_LINK){var q=x.getAttribute(A.ATTR_LINK_TYPE),$=_.currentTarget,W=$.previousElementSibling;W.replaceChildren(),W.insertAdjacentText("beforeend",x.textContent),$.setAttribute(A.ATTR_SHOW,A.HIDDEN),$.setAttribute(A.ATTR_SELECTED,q),_.preventDefault()}}},y={select(_){return _[c(_.length)]},selectHero(_){if(_){if(!_.results||_.results.length===0)throw Error("trending.results does not have data");return y.select(_.results)}},async getHeroLogo(_){if(_===void 0)return;var{id:x,media_type:q}=_,$=await f.getImages(x,q);if($.logos.length>0)return $.logos[0].file_path;else return},initDOMImgLogo(_,x){var q=x.lastElementChild.firstElementChild;if(_!==void 0)q.firstElementChild.setAttribute("data-opacity","0"),q.lastElementChild.setAttribute("data-display","1"),q.lastElementChild.setAttribute("src",`https://image.tmdb.org/t/p/w300${_}`)},initDOM(_,x){var q=x.firstElementChild.firstElementChild,$=x.lastElementChild,W=$.firstElementChild.firstElementChild,z=$.lastElementChild;if(q.setAttribute("data-display","1"),q.setAttribute("src",`https://image.tmdb.org/t/p/w1280${_.backdrop_path}`),_.media_type==="tv")W.insertAdjacentText("beforeend",_.name);else W.insertAdjacentText("beforeend",_.title);$.setAttribute("data-media",_.media_type),$.setAttribute("data-id",_.id),z.insertAdjacentText("beforeend",_.overview)}},G={TYPE_SBUTTON:"data-sbuttont",topScroll:0,DOMCollButtonOnclick(_){var x=_.parentElement.lastElementChild;const q=_.parentElement.children[1],$=_.parentElement.children[2];var W=_.getAttribute(G.TYPE_SBUTTON),z=x.clientWidth-x.clientWidth*6/100;if(x.scrollLeft-z<=0)q.setAttribute("data-display","0");else q.setAttribute("data-display","1");if(W==="0"){if(x.scrollBy(-z,0),x.scrollLeft-z<=0)q.setAttribute("data-display","0");$.setAttribute("data-display","1")}else{if(x.scrollBy(z,0),x.scrollLeft+z>=x.scrollWidth-x.clientWidth)$.setAttribute("data-display","0");q.setAttribute("data-display","1")}},async setItemImage(_,x,q){var $=await _,W=x.firstElementChild;if($===void 0||$.backdrops===void 0||$.backdrops.length===0){if(q!==null&&q.length>0)W.setAttribute("src",`https://image.tmdb.org/t/p/w400${q}`),W.setAttribute("data-display","1"),x.lastElementChild?.setAttribute("data-opacity","0")}else{var z=$.backdrops[0];W.setAttribute("src",`https://image.tmdb.org/t/p/w400${z.file_path}`),W.setAttribute("data-display","1"),x.lastElementChild?.setAttribute("data-opacity","0")}},createDOMCollection(_,x,q,$){var W=$.children[1].cloneNode(!0),z=W.children[0];z.insertAdjacentText("beforeend",_);for(var K of x){const Q=$.children[2].cloneNode(!0);Q.setAttribute("data-id",K.id);let Z,k;if(q!==void 0)k=q;else k=K.media_type;if(k==="movie")Z=K.title;else Z=K.name;Q.setAttribute("title",Z),Q.setAttribute("data-media",k),Q.lastElementChild.insertAdjacentText("beforeend",Z),Q.firstElementChild.setAttribute("alt",Z),G.setItemImage(f.getImages(K.id,k),Q,K.backdrop_path),W.lastElementChild.appendChild(Q)}return W}},h=new AbortController,v={signal:h.signal},J={fragment:document.createDocumentFragment(),dataLoaded:!1,creditsLoaded:!1,orderCredit(_){if(_.length<2)return _.length;var x=0,q=0,$=0,W=1;for(var z=1;z<_.length;z+=1){var K=_[z];if(K.department!=="Crew"){while(x<=q){if(x<q)$=Math.floor((x+q)/2);else $=x;if(K.department<_[$].department)q=$-1;else if(K.department>_[$].department)x=$+1;else if(K.job<_[$].job)q=$-1;else x=$+1}if(x!==W)_.copyWithin(x+1,x,W);_[x]=K,x=0,q=W,W+=1}}return W},async getCredit(_,x,q,$){var W=await f.getCredits(_,x,v);if(W===void 0)return;var z=q.children[3].lastElementChild,K=$.children[0],Q=$.children[1],Z=$.children[2],k=$.children[3],Y,E,X;if(W.cast.length>0){X=Z.cloneNode(!0),X.firstElementChild.textContent="Cast:";for(var u=0;u<W.cast.length;u+=1){var U=W.cast[u];E=K.cloneNode(!1),E.setAttribute("data-id",U.id),E.setAttribute("data-type",w.MODAL_CAST),E.textContent=U.name,X.appendChild(E)}z.appendChild(X),X=void 0}if(W.crew.length>0){var B=W.crew,j=J.orderCredit(B);console.info(B);var F="",L="";for(var b=0;b<j;b+=1){var R=B[b];if(R.department!==F){if(Y!==void 0){if(X!==void 0)Y?.appendChild(X),X=void 0;J.fragment.appendChild(Y)}F=R.department,Y=Q.cloneNode(!0),Y.firstElementChild.textContent=F}if(R.job!==L){if(X!==void 0)Y?.appendChild(X);L=R.job,X=Z.cloneNode(!0),X.firstElementChild.textContent=`${L}:`}if(F==="Directing"&&(L==="Director"||L==="Series Director"))E=K.cloneNode(!0),E.setAttribute("data-id",R.id),E.setAttribute("data-type",w.MODAL_CAST);else E=k.cloneNode(!1);E.textContent=R.name,X.appendChild(E)}if(Y!==void 0){if(X!==void 0)Y?.appendChild(X);J.fragment.appendChild(Y)}z?.appendChild(J.fragment)}J.creditsLoaded=!0},async getData(_,x,q){var $=await f.get(_,x,v);if($===void 0)return;var W,z=q.modal,K=q.templateModal.content.children[2],Q=q.templateModal.content.children[0];if(_==="tv"){W=z.children[0];var Z=W.children[1].firstElementChild.firstElementChild,k=W.children[3].children[0],Y=W.children[3].children[1],E=W.children[3].children[2],X=W.children[3].lastElementChild,Q=q.templateModal.content.children[0],u=q.templateModal.content.children[3],U;if(k.textContent=$.name,E.textContent=$?.overview,$?.backdrop_path!=null)Z.setAttribute("src",`https://image.tmdb.org/t/p/w780${$.backdrop_path}`),Z.setAttribute("alt",$.name),Z.setAttribute("data-display","1");if($.genres.length>0){for(var B of $.genres)U=Q.cloneNode(!0),U.textContent=B.name,U.setAttribute("data-id",B.id),U.setAttribute("data-type",w.MODAL_GENRE),J.fragment.appendChild(U);Y.appendChild(J.fragment)}var j=K.cloneNode(!0);j.firstElementChild.textContent="Popularity:",U=u.cloneNode(!0),U.textContent=String($.popularity),j.appendChild(U),X?.appendChild(j);var F=K.cloneNode(!0);if(F.firstElementChild.textContent="First Air Date:",U=u.cloneNode(!0),U.textContent=$.first_air_date,F.appendChild(U),X.appendChild(F),$.spoken_languages.length>0){var L=K.cloneNode(!0);L.firstElementChild.textContent="Languages:";for(var b of $.spoken_languages){if(U=u.cloneNode(!0),b.name.length>0)U.textContent=b.name;else U.textContent=b.english_name;L.appendChild(U)}X?.appendChild(L)}if($.production_companies.length>0){var R=K.cloneNode(!0);R.firstElementChild.textContent="Companies:";for(var S of $.production_companies)U=Q.cloneNode(!0),Q.setAttribute("data-type",w.MODAL_COMPANY),Q.setAttribute("data-id",S.id),U.textContent=S.name,R.appendChild(U);X?.appendChild(R)}if($.production_countries.length>0){var R=K.cloneNode(!0);R.firstElementChild.textContent="Countries:";for(var C of $.production_countries)U=u.cloneNode(!0),U.textContent=C.name,R.appendChild(U);X?.appendChild(R)}}else{W=z.children[1];var Z=W.children[1].firstElementChild.firstElementChild,k=W.children[3].children[0],Y=W.children[3].children[1],E=W.children[3].children[2],X=W.children[3].lastElementChild,Q=q.templateModal.content.children[0],u=q.templateModal.content.children[3],U;if(k.textContent=$.title,E.textContent=$?.overview,$?.backdrop_path!=null)Z.setAttribute("src",`https://image.tmdb.org/t/p/w780${$.backdrop_path}`),Z.setAttribute("alt",$.title),Z.setAttribute("data-display","1");if($.genres.length>0){for(var B of $.genres)U=Q.cloneNode(!0),U.textContent=B.name,U.setAttribute("data-id",B.id),U.setAttribute("data-type",w.MODAL_GENRE),J.fragment.appendChild(U);Y.appendChild(J.fragment)}var j=K.cloneNode(!0);j.firstElementChild.textContent="Popularity:",U=u.cloneNode(!0),U.textContent=String($.popularity),j.appendChild(U),X?.appendChild(j);var F=K.cloneNode(!0);if(F.firstElementChild.textContent="Release Date:",U=u.cloneNode(!0),U.textContent=$.release_date,F.appendChild(U),X?.appendChild(F),$.spoken_languages.length>0){var L=K.cloneNode(!0);L.firstElementChild.textContent="Languages:";for(var b of $.spoken_languages){if(U=u.cloneNode(!0),b.name.length>0)U.textContent=b.name;else U.textContent=b.english_name;L.appendChild(U)}X?.appendChild(L)}if($.production_companies.length>0){var R=K.cloneNode(!0);R.firstElementChild.textContent="Companies:";for(var S of $.production_companies)U=Q.cloneNode(!0),Q.setAttribute("data-type",w.MODAL_COMPANY),Q.setAttribute("data-id",S.id),U.textContent=S.name,R.appendChild(U);X?.appendChild(R)}if($.production_countries.length>0){var R=K.cloneNode(!0);R.firstElementChild.textContent="Countries:";for(var C of $.production_countries)U=u.cloneNode(!0),U.textContent=C.name,R.appendChild(U);X?.appendChild(R)}}J.getCredit(_,x,W,q.templateModal.content),J.dataLoaded=!0,console.info($)},close(_){if(!J.dataLoaded||!J.creditsLoaded)s("Close Modal");J.dataLoaded=!1,J.creditsLoaded=!1;var x=_.modal.getAttribute("data-select"),q;if(x==="tv")q=_.modal.children[0];else q=_.modal.children[1];var $=q.children[1].firstElementChild?.firstElementChild,W=q.children[3].children[0],z=q.children[3].children[1],K=q.children[3].children[2];q.children[3].lastElementChild.replaceChildren(),$.setAttribute("data-display","0"),W.textContent="",K.textContent="",z.replaceChildren(),_.main.style.removeProperty("transform"),_.main.style.setProperty("position","relative"),document.firstElementChild.scrollTop=G.topScroll,_.modal.setAttribute("data-display","0")},open(_,x,q){G.topScroll=document.firstElementChild.scrollTop,document.firstElementChild.scrollTop=0,q.modal.setAttribute("data-display","1"),q.modal.setAttribute("data-select",_),q.main.style.setProperty("transform",`translateY(-${G.topScroll}px)`),q.main.style.setProperty("position","fixed"),J.getData(_,x,q)}};window.addEventListener("DOMContentLoaded",function(){var _={templateCollection:document.getElementById("template_collection"),templateIcons:document.getElementById("template_icons"),templateModal:document.getElementById("template_modal"),headerButtonNav:document.getElementById("header_button-nav"),headerNav:document.getElementById("header_nav"),headerButtonSearch:document.getElementById("header_button-search"),headerButtonTheme:document.getElementById("header_button-theme"),main:document.getElementById("main"),hero:document.getElementById("hero"),view:document.getElementById("view"),buttonMore:document.getElementById("button-more"),modal:document.getElementById("modal")};if(_.templateCollection===null)throw Error("DOM.templateCollection is null");if(_.templateIcons===null)throw Error("DOM.templateIcons is null");if(_.templateModal===null)throw Error("DOM.templateModal is null");if(_.headerButtonNav===null)throw Error("DOM.headerButtonNav is null");if(_.headerNav===null)throw Error("DOM.headerNav is null");if(_.headerButtonSearch===null)throw Error("DOM.headerButtonSearch is null");if(_.headerButtonTheme===null)throw Error("DOM.headerButtonTheme is null");if(_.main===null)throw Error("DOM.main is null");if(_.hero===null)throw Error("DOM.hero is null");if(_.view===null)throw Error("DOM.view is null");if(_.buttonMore===null)throw Error("DOM.buttonMore is null");if(_.modal===null)throw Error("DOM.modal is null");H.init(),_.headerButtonTheme.setAttribute("data-type",H.current),_.headerButtonTheme.addEventListener("click",H.onclick),_.headerButtonNav.addEventListener("click",A.buttonNavOnclick),_.headerNav.addEventListener("focusout",A.navOnfocusout),_.headerNav.addEventListener("click",A.navOnclick),_.view.addEventListener("click",function(z){var K=z.target,Q=K.getAttribute("data-type");if(Q===w.COLL_BUTTON)G.DOMCollButtonOnclick(K);else if(Q===w.COLL_ITEM){var Z=K?.getAttribute("data-media"),k=K?.getAttribute("data-id");J.open(Z,k,_)}}),_.hero.lastElementChild.addEventListener("click",function(z){var K=z.target,Q=K?.getAttribute("data-id");if(Q!==void 0){var Z=K?.getAttribute("data-media");J.open(Z,Q,_)}}),_.modal.addEventListener("click",function(z){var K=z.target,Q=K.getAttribute("data-type");if(Q===w.MODAL||Q===w.MODAL_CLOSE)J.close(_)});var x=f.getTrending("1");x.then(function(z){console.info("trending: ",z)});var q=x.then(y.selectHero);q.then(function(z){console.info("hero: ",z)}),q.then(y.getHeroLogo).then(function(z){y.initDOMImgLogo(z,_.hero)}),q.then(function(z){if(z!==void 0)y.initDOM(z,_.hero)}),x.then(function(z){if(z?.results===void 0||z.results.length===0)throw Error("API.getTrending does not have data");var K=G.createDOMCollection("Week Trendings",z.results,void 0,_.templateCollection.content),Q=_.view.children[0];Q.insertAdjacentElement("beforebegin",K),Q.remove()}),f.getPopular("movie","1").then(function(z){if(console.info("getPopular movie",z),z?.results===void 0||z.results.length===0)throw Error("API.getDiscover does not have data");var K=G.createDOMCollection("Popular Movies",z.results,"movie",_.templateCollection.content),Q=_.view.children[1];Q.insertAdjacentElement("beforebegin",K),Q.remove()}),f.getPopular("tv","1").then(function(z){if(console.info("getPopular tv",z),z?.results===void 0||z.results.length===0)throw Error("API.getDiscover does not have data");var K=G.createDOMCollection("Popular Tv series",z.results,"tv",_.templateCollection.content),Q=_.view.children[2];Q.insertAdjacentElement("beforebegin",K),Q.remove()}),f.getTopRated("movie","1").then(function(z){if(console.info("getTopRate movie",z),z?.results===void 0||z.results.length===0)throw Error("API.getTopRated does not have data");var K=G.createDOMCollection("Top rated movie",z.results,"movie",_.templateCollection.content),Q=_.view.children[3];Q.insertAdjacentElement("beforebegin",K),Q.remove()}),f.getTopRated("tv","1").then(function(z){if(console.info("getTopRate tv",z),z?.results===void 0||z.results.length===0)throw Error("API.getTopRated does not have data");var K=G.createDOMCollection("Top rated tv serie",z.results,"tv",_.templateCollection.content),Q=_.view.children[4];Q.insertAdjacentElement("beforebegin",K),Q.remove()});var $=f.getGenres("movie"),W=f.getGenres("tv");Promise.all([$,W]).then(function(z){if(console.info("movie genres",z[0]),console.info("tv genres",z[1]),z[0]===void 0||z[0].genres===void 0||z[0].genres.length===0)throw Error("API.getGenre does not have data");if(z[1]===void 0||z[1].genres===void 0||z[1].genres.length===0)throw Error("API.getGenre does not have data");var K=z[0].genres,Q=z[1].genres;if(V.tvGenres=Q,V.movieGenres=K,K.length+Q.length<V.MAX)V.len=K.length+Q.length;else V.len=V.MAX;if(console.info(V),_.buttonMore?.setAttribute("data-display","1"),K.length>1)P(K);if(Q.length>1)P(Q);var Z,k,Y,E,X=0,u=0;for(let U=0;U<2;U+=1){if(Math.random()<0.5)k=K[X].id,Y=K[X].name,Z="movie",E=`${Y} Movies`,X+=1,V.imov+=1;else k=Q[u].id,Y=Q[u].name,Z="tv",E=`${Y} Tv series`,u+=1,V.itv+=1;g(f.getDiscover(Z,k,"1"),E,Z,U,5,_)}}),_.buttonMore.addEventListener("click",function(z){var K,Q,Z,k,Y=V.movieGenres,E=V.tvGenres,X=V.itv,u=V.imov,U=0;_.buttonMore?.setAttribute("data-display","0");var B=0,j=!1;if(V.count+V.STEPS<V.len)B=V.count+V.STEPS;else B=V.len,j=!0;for(var F=V.count;F<B;F+=1){var L=_.templateCollection.content.children[0].cloneNode(!0);_.view?.appendChild(L)}for(var F=V.count;F<B;F+=1){if(X<E.length&&u<Y.length){if(Math.random()<0.5)U=1}else if(tv<E.length)U=1;if(U===0)Q=Y[u].id,Z=Y[u].name,K="movie",k=`${Z} Movies`,u+=1,V.imov+=1;else Q=E[X].id,Z=E[X].name,K="tv",k=`${Z} Tv series`,X+=1,V.itv+=1;V.count+=1,g(f.getDiscover(K,Q,"1"),k,K,F,_.view.children.length-B,_)}if(!j)_.buttonMore?.setAttribute("data-display","1")})});
