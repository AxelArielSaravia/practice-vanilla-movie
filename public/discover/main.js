import R from"../general.js";async function L(f,F,C){var u;try{u=await f}catch{v.ended=!0,DocumentFragment.prototype.replaceChildren.apply(C.templateSkeleton.content,b);return}if(u?.results===void 0||u.results.length===0){v.ended=!0,DocumentFragment.prototype.replaceChildren.apply(C.templateSkeleton.content,b);return}console.info(u);var E;for(var A of u.results)E=R.Item.createDOMItem(A,F,C.templateItem?.content?.firstElementChild),v.fragment.appendChild(E);DocumentFragment.prototype.replaceChildren.apply(C.templateSkeleton.content,b),C.view.appendChild(v.fragment),C.buttonMore.setAttribute("data-display","1")}var v={fragment:document.createDocumentFragment(),maxPages:0,page:3,ended:!1},b=Array(6);window.addEventListener("DOMContentLoaded",function(){var f={templateSkeleton:document.getElementById("template_skeleton"),templateItem:document.getElementById("template_item"),templateModal:document.getElementById("template_modal"),headerPNav:document.getElementById("header_p_nav"),headerButtonTheme:document.getElementById("header_button-theme"),main:document.getElementById("main"),view:document.getElementById("view"),buttonMore:document.getElementById("button-more"),modal:document.getElementById("modal")};if(f.templateSkeleton===null)throw Error("DOM.templateSkeleton is null");if(f.templateItem===null)throw Error("DOM.templateItem is null");if(f.templateModal===null)throw Error("DOM.templateModal is null");if(f.headerPNav===null)throw Error("DOM.headerPNav is null");if(f.headerButtonTheme===null)throw Error("DOM.headerButtonTheme is null");if(f.main===null)throw Error("DOM.main is null");if(f.view===null)throw Error("DOM.view is null");if(f.buttonMore===null)throw Error("DOM.buttonMore is null");if(f.modal===null)throw Error("DOM.modal is null");R.Route.url.href=window.location.href;var F=R.Route.url,C=F.searchParams.get(R.Route.Q_TITLE),u=F.searchParams.get(R.Route.Q_MEDIA_TYPE),E=F.searchParams.get(R.Route.Q_GENRE),A=F.searchParams.get(R.Route.Q_CREW),x=F.searchParams.get(R.Route.Q_CAST),z=F.searchParams.get(R.Route.Q_COMPANY);if(u===null)throw Error("Bad Route");if(C!==null)f.main.firstElementChild.textContent=C;var B,H;if(console.info(u,E,A,x,z),E!==null)B=R.API.getDiscover(u,"1",E,void 0,void 0,void 0),H=R.API.getDiscover(u,"2",E,void 0,void 0,void 0),R.Route.hrefq=`${R.Route.href}?${R.Route.Q_TITLE}=${C}&${R.Route.Q_GENRE}=${E}&`;else if(x!==null)B=R.API.getDiscover(u,"1",void 0,x,void 0,void 0),H=R.API.getDiscover(u,"2",void 0,x,void 0,void 0),R.Route.hrefq=`${R.Route.href}?${R.Route.Q_TITLE}=${C}&${R.Route.Q_CAST}=${x}&`;else if(A!==null)B=R.API.getDiscover(u,"1",void 0,void 0,A,void 0),H=R.API.getDiscover(u,"2",void 0,void 0,A,void 0),R.Route.hrefq=`${R.Route.href}?${R.Route.Q_TITLE}=${C}&${R.Route.Q_CREW}=${A}&`;else if(z!==null)B=R.API.getDiscover(u,"1",void 0,void 0,void 0,z),H=R.API.getDiscover(u,"2",void 0,void 0,void 0,z),R.Route.hrefq=`${R.Route.href}?${R.Route.Q_TITLE}=${C}&${R.Route.Q_COMPANY}=${z}&`;else throw Error("Bad Route");b[0]=f.view.children[0],b[1]=f.view.children[1],b[2]=f.view.children[2],b[3]=f.view.children[3],b[4]=f.view.children[4],b[5]=f.view.children[5],R.Theme.init(),R.Route.href=`${R.Route.hrefq}${R.Route.Q_MEDIA_TYPE}=${u}`,R.Route.init(f),window.addEventListener("popstate",function(){R.Route.onpopstate(f)}),f.headerButtonTheme.setAttribute("data-type",R.Theme.current),f.headerButtonTheme.addEventListener("click",R.Theme.onclick),f.headerPNav.firstElementChild.addEventListener("click",R.Nav.buttonNavOnclick),f.headerPNav.lastElementChild.addEventListener("focusout",R.Nav.navOnfocusout),f.buttonMore.addEventListener("click",function(){if(f.buttonMore?.setAttribute("data-display","0"),v.ended)return;f.view.appendChild(f.templateSkeleton.content);var h;if(E!==null)h=R.API.getDiscover(u,String(v.page),E,void 0,void 0,void 0);else if(x!==null)h=R.API.getDiscover(u,String(v.page),void 0,x,void 0,void 0);else if(A!==null)h=R.API.getDiscover(u,String(v.page),void 0,void 0,A,void 0);else if(z!==null)h=R.API.getDiscover(u,String(v.page),void 0,void 0,void 0,z);L(h,u,f),v.page+=1}),f.view.addEventListener("click",function(h){var $=h.target,J=$.getAttribute("data-type");if(J===R.TYPE.ITEM){h.preventDefault();var K=$.getAttribute("data-id");if(K!==null)R.Modal.open(u,K,f,!0)}}),f.modal.addEventListener("click",function(h){R.Modal.onclick(h.target,f)}),f.modal.addEventListener("change",function(h){R.Modal.onchange(h.target,f)}),B.then(function(h){if(console.info(h),h?.results===void 0||h.results.length===0){v.ended=!0,f.main.children[1].setAttribute("data-display","1");return}var $;for(var J of h.results)$=R.Item.createDOMItem(J,u,f.templateItem?.content?.firstElementChild),v.fragment.appendChild($);DocumentFragment.prototype.replaceChildren.apply(f.templateSkeleton.content,b),f.view.appendChild(v.fragment),B=null}),H.then(function(h){if(console.info(h),h?.results===void 0||h.results.length===0){v.ended=!0;return}var $;for(var J of h.results)$=R.Item.createDOMItem(J,u,f.templateItem?.content?.firstElementChild),v.fragment.appendChild($);f.view.appendChild(v.fragment),f.buttonMore?.setAttribute("data-display","1"),H=null})});
