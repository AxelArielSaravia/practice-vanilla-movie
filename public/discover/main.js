import f from"../general.js";async function L(h,x,P){var E;try{E=await h}catch{F.ended=!0,DocumentFragment.prototype.replaceChildren.apply(P.templateSkeleton.content,R);return}if(E?.results===void 0||E.results.length===0){F.ended=!0,DocumentFragment.prototype.replaceChildren.apply(P.templateSkeleton.content,R);return}console.info(E);var Q;for(var v of E.results)Q=f.Item.createDOMItem(v,x,P.templateItem?.content?.firstElementChild),F.fragment.appendChild(Q);DocumentFragment.prototype.replaceChildren.apply(P.templateSkeleton.content,R),P.view.appendChild(F.fragment),P.buttonMore.setAttribute("data-display","1")}var F={fragment:document.createDocumentFragment(),maxPages:0,page:3,ended:!1},R=Array(6);window.addEventListener("DOMContentLoaded",function(){var h={templateSkeleton:document.getElementById("template_skeleton"),templateItem:document.getElementById("template_item"),templateModal:document.getElementById("template_modal"),headerPNav:document.getElementById("header_p_nav"),headerSearch:document.getElementById("header_search"),headerButtonTheme:document.getElementById("header_button-theme"),main:document.getElementById("main"),view:document.getElementById("view"),buttonMore:document.getElementById("button-more"),modal:document.getElementById("modal")};if(h.templateSkeleton===null)throw Error("DOM.templateSkeleton is null");if(h.templateItem===null)throw Error("DOM.templateItem is null");if(h.templateModal===null)throw Error("DOM.templateModal is null");if(h.headerPNav===null)throw Error("DOM.headerPNav is null");if(h.headerSearch===null)throw Error("DOM.headerSearch is null");if(h.headerButtonTheme===null)throw Error("DOM.headerButtonTheme is null");if(h.main===null)throw Error("DOM.main is null");if(h.view===null)throw Error("DOM.view is null");if(h.buttonMore===null)throw Error("DOM.buttonMore is null");if(h.modal===null)throw Error("DOM.modal is null");f.Route.url.href=window.location.href;var x=f.Route.url,P=x.searchParams.get(f.Route.Q_TITLE),E=x.searchParams.get(f.Route.Q_MEDIA_TYPE),Q=x.searchParams.get(f.Route.Q_GENRE),v=x.searchParams.get(f.Route.Q_CREW),A=x.searchParams.get(f.Route.Q_CAST),B=x.searchParams.get(f.Route.Q_COMPANY);if(E===null)throw Error("Bad Route");if(P!==null)h.main.firstElementChild.textContent=P;var C,H;if(console.info(E,Q,v,A,B),Q!==null)C=f.API.getDiscover(E,"1",Q,void 0,void 0,void 0),H=f.API.getDiscover(E,"2",Q,void 0,void 0,void 0),f.Route.hrefq=`${f.Route.href}?${f.Route.Q_TITLE}=${P}&${f.Route.Q_GENRE}=${Q}&`;else if(A!==null)C=f.API.getDiscover(E,"1",void 0,A,void 0,void 0),H=f.API.getDiscover(E,"2",void 0,A,void 0,void 0),f.Route.hrefq=`${f.Route.href}?${f.Route.Q_TITLE}=${P}&${f.Route.Q_CAST}=${A}&`;else if(v!==null)C=f.API.getDiscover(E,"1",void 0,void 0,v,void 0),H=f.API.getDiscover(E,"2",void 0,void 0,v,void 0),f.Route.hrefq=`${f.Route.href}?${f.Route.Q_TITLE}=${P}&${f.Route.Q_CREW}=${v}&`;else if(B!==null)C=f.API.getDiscover(E,"1",void 0,void 0,void 0,B),H=f.API.getDiscover(E,"2",void 0,void 0,void 0,B),f.Route.hrefq=`${f.Route.href}?${f.Route.Q_TITLE}=${P}&${f.Route.Q_COMPANY}=${B}&`;else throw Error("Bad Route");R[0]=h.view.children[0],R[1]=h.view.children[1],R[2]=h.view.children[2],R[3]=h.view.children[3],R[4]=h.view.children[4],R[5]=h.view.children[5],f.Theme.init(),f.Route.href=`${f.Route.hrefq}${f.Route.Q_MEDIA_TYPE}=${E}`,f.Route.init(h),window.addEventListener("popstate",function(){f.Route.onpopstate(h)}),h.headerButtonTheme.setAttribute("data-type",f.Theme.current),h.headerButtonTheme.addEventListener("click",f.Theme.onclick),h.headerPNav.firstElementChild.addEventListener("click",f.Nav.buttonNavOnclick),h.headerPNav.lastElementChild.addEventListener("focusout",f.Nav.navOnfocusout),h.headerSearch.children[1].addEventListener("click",function(b){h.headerSearch.reset()}),h.buttonMore.addEventListener("click",function(){if(h.buttonMore?.setAttribute("data-display","0"),F.ended)return;h.view.appendChild(h.templateSkeleton.content);var b;if(Q!==null)b=f.API.getDiscover(E,String(F.page),Q,void 0,void 0,void 0);else if(A!==null)b=f.API.getDiscover(E,String(F.page),void 0,A,void 0,void 0);else if(v!==null)b=f.API.getDiscover(E,String(F.page),void 0,void 0,v,void 0);else if(B!==null)b=f.API.getDiscover(E,String(F.page),void 0,void 0,void 0,B);L(b,E,h),F.page+=1}),h.view.addEventListener("click",function(b){var z=b.target,J=z.getAttribute("data-type");if(J===f.TYPE.ITEM){b.preventDefault();var K=z.getAttribute("data-id");if(K!==null)f.Modal.open(E,K,h,!0)}}),h.modal.addEventListener("click",function(b){f.Modal.onclick(b.target,h)}),h.modal.addEventListener("change",function(b){f.Modal.onchange(b.target,h)}),C.then(function(b){if(console.info(b),b?.results===void 0||b.results.length===0)F.ended=!0,h.main.children[1].setAttribute("data-display","1");else{var z;for(var J of b.results)z=f.Item.createDOMItem(J,E,h.templateItem?.content?.firstElementChild),F.fragment.appendChild(z)}DocumentFragment.prototype.replaceChildren.apply(h.templateSkeleton.content,R),h.view.appendChild(F.fragment),C=null}),H.then(function(b){if(console.info(b),b?.results===void 0||b.results.length===0){F.ended=!0;return}var z;for(var J of b.results)z=f.Item.createDOMItem(J,E,h.templateItem?.content?.firstElementChild),F.fragment.appendChild(z);h.view.appendChild(F.fragment),h.buttonMore?.setAttribute("data-display","1"),H=null})});
