import f from"../general.js";async function K(h,_,C){var v;try{v=await h}catch{R.ended=!0,DocumentFragment.prototype.replaceChildren.apply(C.templateSkeleton.content,F);return}if(v?.results===void 0||v.results.length===0){R.ended=!0,DocumentFragment.prototype.replaceChildren.apply(C.templateSkeleton.content,F);return}console.info(v);var b;for(var Q of v.results)b=f.Item.createDOMItem(Q,_,C.templateItem?.content?.firstElementChild),R.fragment.appendChild(b);DocumentFragment.prototype.replaceChildren.apply(C.templateSkeleton.content,F),C.view.appendChild(R.fragment),C.buttonMore.setAttribute("data-display","1")}var R={fragment:document.createDocumentFragment(),maxPages:0,page:3,ended:!1},F=Array(6);window.addEventListener("DOMContentLoaded",function(){var h={templateSkeleton:document.getElementById("template_skeleton"),templateItem:document.getElementById("template_item"),templateModal:document.getElementById("template_modal"),headerPNav:document.getElementById("header_p_nav"),headerSearch:document.getElementById("header_search"),headerButtonTheme:document.getElementById("header_button-theme"),main:document.getElementById("main"),view:document.getElementById("view"),buttonMore:document.getElementById("button-more"),modal:document.getElementById("modal")};if(h.templateSkeleton===null)throw Error("DOM.templateSkeleton is null");if(h.templateItem===null)throw Error("DOM.templateItem is null");if(h.templateModal===null)throw Error("DOM.templateModal is null");if(h.headerPNav===null)throw Error("DOM.headerPNav is null");if(h.headerSearch===null)throw Error("DOM.headerSearch is null");if(h.headerButtonTheme===null)throw Error("DOM.headerButtonTheme is null");if(h.main===null)throw Error("DOM.main is null");if(h.view===null)throw Error("DOM.view is null");if(h.buttonMore===null)throw Error("DOM.buttonMore is null");if(h.modal===null)throw Error("DOM.modal is null");f.Route.url.href=window.location.href;var _=f.Route.url,C=_.searchParams.get(f.Route.Q_TITLE),v=_.searchParams.get(f.Route.Q_MEDIA_TYPE),b=_.searchParams.get(f.Route.Q_GENRE),Q=_.searchParams.get(f.Route.Q_CREW),x=_.searchParams.get(f.Route.Q_CAST),z=_.searchParams.get(f.Route.Q_COMPANY);if(v===null){window.open("./404.html","_self","noopener,noreferrer");return}if(C!==null)h.main.firstElementChild.textContent=C;var A,B;if(console.info(v,b,Q,x,z),b!==null)A=f.API.getDiscover(v,"1",b,void 0,void 0,void 0),B=f.API.getDiscover(v,"2",b,void 0,void 0,void 0),f.Route.hrefq=`${f.Route.href}?${f.Route.Q_TITLE}=${C}&${f.Route.Q_GENRE}=${b}&`;else if(x!==null)A=f.API.getDiscover(v,"1",void 0,x,void 0,void 0),B=f.API.getDiscover(v,"2",void 0,x,void 0,void 0),f.Route.hrefq=`${f.Route.href}?${f.Route.Q_TITLE}=${C}&${f.Route.Q_CAST}=${x}&`;else if(Q!==null)A=f.API.getDiscover(v,"1",void 0,void 0,Q,void 0),B=f.API.getDiscover(v,"2",void 0,void 0,Q,void 0),f.Route.hrefq=`${f.Route.href}?${f.Route.Q_TITLE}=${C}&${f.Route.Q_CREW}=${Q}&`;else if(z!==null)A=f.API.getDiscover(v,"1",void 0,void 0,void 0,z),B=f.API.getDiscover(v,"2",void 0,void 0,void 0,z),f.Route.hrefq=`${f.Route.href}?${f.Route.Q_TITLE}=${C}&${f.Route.Q_COMPANY}=${z}&`;else throw Error("Bad Route");F[0]=h.view.children[0],F[1]=h.view.children[1],F[2]=h.view.children[2],F[3]=h.view.children[3],F[4]=h.view.children[4],F[5]=h.view.children[5],f.Theme.init(),f.Route.href=`${f.Route.hrefq}${f.Route.Q_MEDIA_TYPE}=${v}`,f.Route.init(h),window.addEventListener("popstate",function(){f.Route.onpopstate(h)}),h.headerButtonTheme.setAttribute("data-type",f.Theme.current),h.headerButtonTheme.addEventListener("click",f.Theme.onclick),h.headerPNav.firstElementChild.addEventListener("click",f.Nav.buttonNavOnclick),h.headerPNav.lastElementChild.addEventListener("focusout",f.Nav.navOnfocusout),h.headerSearch.children[1].addEventListener("click",function(E){h.headerSearch.reset()}),h.buttonMore.addEventListener("click",function(){if(h.buttonMore?.setAttribute("data-display","0"),R.ended)return;h.view.appendChild(h.templateSkeleton.content);var E;if(b!==null)E=f.API.getDiscover(v,String(R.page),b,void 0,void 0,void 0);else if(x!==null)E=f.API.getDiscover(v,String(R.page),void 0,x,void 0,void 0);else if(Q!==null)E=f.API.getDiscover(v,String(R.page),void 0,void 0,Q,void 0);else if(z!==null)E=f.API.getDiscover(v,String(R.page),void 0,void 0,void 0,z);K(E,v,h),R.page+=1}),h.view.addEventListener("click",function(E){var u=E.target,H=u.getAttribute("data-type");if(H===f.TYPE.ITEM){E.preventDefault();var J=u.getAttribute("data-id");if(J!==null)f.Modal.open(v,J,h,!0)}}),h.modal.addEventListener("click",function(E){f.Modal.onclick(E.target,h)}),h.modal.addEventListener("change",function(E){f.Modal.onchange(E.target,h)}),A.then(function(E){if(console.info(E),E?.results===void 0||E.results.length===0)R.ended=!0,h.main.children[1].setAttribute("data-display","1");else{var u;for(var H of E.results)u=f.Item.createDOMItem(H,v,h.templateItem?.content?.firstElementChild),R.fragment.appendChild(u)}DocumentFragment.prototype.replaceChildren.apply(h.templateSkeleton.content,F),h.view.appendChild(R.fragment),A=null}),B.then(function(E){if(console.info(E),E?.results===void 0||E.results.length===0){R.ended=!0;return}var u;for(var H of E.results)u=f.Item.createDOMItem(H,v,h.templateItem?.content?.firstElementChild),R.fragment.appendChild(u);h.view.appendChild(R.fragment),h.buttonMore?.setAttribute("data-display","1"),B=null})});
