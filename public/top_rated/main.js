import u from"../general.js";async function B(n,x,c){var w;try{w=await n}catch{h.ended=!0,DocumentFragment.prototype.replaceChildren.apply(c.templateSkeleton.content,v);return}if(w?.results===void 0||w.results.length===0){h.ended=!0,DocumentFragment.prototype.replaceChildren.apply(c.templateSkeleton.content,v);return}var E;for(var f of w.results)E=u.Item.createDOMItem(f,x,c.templateItem?.content?.firstElementChild),h.fragment.appendChild(E);DocumentFragment.prototype.replaceChildren.apply(c.templateSkeleton.content,v),c.view.appendChild(h.fragment),c.buttonMore.setAttribute("data-display","1")}var h={fragment:document.createDocumentFragment(),maxPages:0,page:1,ended:!1},v=Array(6);window.addEventListener("DOMContentLoaded",function(){var n={templateSkeleton:document.getElementById("template_skeleton"),templateItem:document.getElementById("template_item"),templateModal:document.getElementById("template_modal"),headerPNav:document.getElementById("header_p_nav"),headerButtonSearch:document.getElementById("header_button-search"),headerButtonTheme:document.getElementById("header_button-theme"),main:document.getElementById("main"),view:document.getElementById("view"),buttonMore:document.getElementById("button-more"),modal:document.getElementById("modal")};if(n.templateSkeleton===null)throw Error("DOM.templateSkeleton is null");if(n.templateItem===null)throw Error("DOM.templateItem is null");if(n.templateModal===null)throw Error("DOM.templateModal is null");if(n.headerPNav===null)throw Error("DOM.headerPNav is null");if(n.headerButtonSearch===null)throw Error("DOM.headerButtonSearch is null");if(n.headerButtonTheme===null)throw Error("DOM.headerButtonTheme is null");if(n.main===null)throw Error("DOM.main is null");if(n.view===null)throw Error("DOM.view is null");if(n.buttonMore===null)throw Error("DOM.buttonMore is null");if(n.modal===null)throw Error("DOM.modal is null");u.Route.url.href=window.location.href;var x=u.Route.url,c=x.searchParams.get(u.Route.Q_MEDIA_TYPE);if(c==="tv")n.main.firstElementChild.textContent+=" Tv Series";else if(c==="movie")n.main.firstElementChild.textContent+=" Movies";else throw Error("Bad Route");v[0]=n.view.children[0],v[1]=n.view.children[1],v[2]=n.view.children[2],v[3]=n.view.children[3],v[4]=n.view.children[4],v[5]=n.view.children[5],u.Theme.init(),u.Route.href=`${u.Route.href}?${u.Route.Q_MEDIA_TYPE}=${c}`,u.Route.init(n),window.addEventListener("popstate",function(){u.Route.onpopstate(n)}),n.headerButtonTheme.setAttribute("data-type",u.Theme.current),n.headerButtonTheme.addEventListener("click",u.Theme.onclick),n.headerPNav.firstElementChild.addEventListener("click",u.Nav.buttonNavOnclick),n.headerPNav.lastElementChild.addEventListener("focusout",u.Nav.navOnfocusout),n.buttonMore.addEventListener("click",function(f){if(n.buttonMore?.setAttribute("data-display","0"),h.ended)return;n.view.appendChild(n.templateSkeleton.content),B(u.API.getTopRated(c,String(h.page)),c,n),h.page+=1}),n.view.addEventListener("click",function(f){var A=f.target,b=A.getAttribute("data-type");if(b===u.TYPE.ITEM){f.preventDefault();var z=A.getAttribute("data-id");if(z!==null)u.Modal.open(c,z,n,!0)}}),n.modal.addEventListener("click",function(f){u.Modal.onclick(f.target,n)}),n.modal.addEventListener("change",function(f){u.Modal.onchange(f.target,n)});var w=u.API.getTopRated(c,String(h.page));h.page+=1;var E=u.API.getTopRated(c,String(h.page));h.page+=1,w.then(function(f){if(f?.results===void 0||f.results.length===0){h.ended=!0,n.main.children[1].setAttribute("data-display","1");return}var A;for(var b of f.results)A=u.Item.createDOMItem(b,c,n.templateItem?.content?.firstElementChild),h.fragment.appendChild(A);DocumentFragment.prototype.replaceChildren.apply(n.templateSkeleton.content,v),n.view.appendChild(h.fragment),w=null}),E.then(function(f){if(f?.results===void 0||f.results.length===0){h.ended=!0;return}var A;for(var b of f.results)A=u.Item.createDOMItem(b,c,n.templateItem?.content?.firstElementChild),h.fragment.appendChild(A);n.view.appendChild(h.fragment),n.buttonMore?.setAttribute("data-display","1"),E=null})});
